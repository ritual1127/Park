<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ë©”ì¹´ 4ë°˜">
<meta name="theme-color" content="#0a0a0f">
<title>ë©”ì¹´ 4ë°˜</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

:root {
  --bg: #0a0a0f;
  --bg-secondary: #12121a;
  --bg-card: #1a1a24;
  --bg-card-hover: #22222e;
  --fg: #f0f0f5;
  --fg-secondary: #8a8a95;
  --fg-muted: #5a5a65;
  --primary: #6366f1;
  --primary-glow: rgba(99, 102, 241, 0.3);
  --secondary: #22d3ee;
  --accent-green: #10b981;
  --accent-orange: #f59e0b;
  --accent-red: #ef4444;
  --accent-purple: #a855f7;
  --border: rgba(255, 255, 255, 0.08);
  --border-light: rgba(255, 255, 255, 0.12);
  --shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
  --radius: 16px;
  --radius-sm: 10px;
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

[data-theme="light"] {
  --bg: #f8f9fc;
  --bg-secondary: #ffffff;
  --bg-card: #ffffff;
  --bg-card-hover: #f0f1f5;
  --fg: #1a1a2e;
  --fg-secondary: #6b7280;
  --fg-muted: #9ca3af;
  --border: rgba(0, 0, 0, 0.08);
  --border-light: rgba(0, 0, 0, 0.12);
  --shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
}

html, body {
  height: 100%;
  overflow: hidden;
}

body {
  font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--fg);
  -webkit-font-smoothing: antialiased;
}

.app-container {
  height: 100%;
  display: flex;
  flex-direction: column;
  max-width: 500px;
  margin: 0 auto;
  background: var(--bg);
  position: relative;
  overflow: hidden;
}

/* Header */
.header {
  padding: 16px 20px;
  padding-top: max(16px, env(safe-area-inset-top));
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 100;
}

.header-title {
  font-size: 20px;
  font-weight: 800;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.header-subtitle {
  font-size: 11px;
  color: var(--fg-muted);
  margin-top: 2px;
}

.theme-btn {
  width: 40px;
  height: 40px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--fg);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  transition: var(--transition);
}

.theme-btn:active {
  transform: scale(0.95);
}

/* Page Container */
.page-container {
  flex: 1;
  overflow: hidden;
  position: relative;
}

.page {
  position: absolute;
  inset: 0;
  overflow-y: auto;
  padding: 20px;
  padding-bottom: 100px;
  opacity: 0;
  transform: translateX(20px);
  pointer-events: none;
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.page.active {
  opacity: 1;
  transform: translateX(0);
  pointer-events: auto;
}

/* Bottom Navigation */
.bottom-nav {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--bg-secondary);
  border-top: 1px solid var(--border);
  padding: 8px 12px;
  padding-bottom: max(8px, env(safe-area-inset-bottom));
  display: flex;
  justify-content: space-around;
  gap: 4px;
  z-index: 100;
}

.nav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 8px 4px;
  border-radius: 12px;
  cursor: pointer;
  transition: var(--transition);
  background: transparent;
  border: none;
  color: var(--fg-muted);
}

.nav-item.active {
  color: var(--primary);
  background: var(--primary-glow);
}

.nav-item:active {
  transform: scale(0.95);
}

.nav-icon {
  font-size: 22px;
  line-height: 1;
}

.nav-label {
  font-size: 10px;
  font-weight: 600;
}

/* Cards */
.card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 16px;
  transition: var(--transition);
}

.card:hover {
  border-color: var(--border-light);
}

.card-title {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card-title-icon {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}

/* Home Page Styles */
.home-hero {
  text-align: center;
  padding: 40px 20px;
  background: linear-gradient(180deg, var(--bg-card) 0%, transparent 100%);
  border-radius: var(--radius);
  margin-bottom: 24px;
  position: relative;
  overflow: hidden;
}

.home-hero::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle at center, var(--primary-glow) 0%, transparent 50%);
  animation: pulse 4s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.3; transform: scale(1); }
  50% { opacity: 0.6; transform: scale(1.1); }
}

.home-logo {
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  border-radius: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
  font-weight: 900;
  color: white;
  margin: 0 auto 20px;
  position: relative;
  z-index: 1;
  box-shadow: 0 8px 32px var(--primary-glow);
}

.home-title {
  font-size: 28px;
  font-weight: 900;
  margin-bottom: 8px;
  position: relative;
  z-index: 1;
}

.home-desc {
  font-size: 14px;
  color: var(--fg-secondary);
  position: relative;
  z-index: 1;
}

.menu-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.menu-item {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px 16px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
}

.menu-item:hover {
  background: var(--bg-card-hover);
  border-color: var(--border-light);
  transform: translateY(-2px);
}

.menu-item:active {
  transform: scale(0.98);
}

.menu-icon {
  width: 56px;
  height: 56px;
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  margin: 0 auto 12px;
}

.menu-icon.blue { background: linear-gradient(135deg, #3b82f6, #6366f1); }
.menu-icon.green { background: linear-gradient(135deg, #10b981, #22d3ee); }
.menu-icon.orange { background: linear-gradient(135deg, #f59e0b, #ef4444); }
.menu-icon.purple { background: linear-gradient(135deg, #a855f7, #ec4899); }

.menu-name {
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 4px;
}

.menu-desc {
  font-size: 11px;
  color: var(--fg-muted);
}

/* Form Elements */
.form-group {
  margin-bottom: 16px;
}

.form-label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--fg-secondary);
  margin-bottom: 8px;
}

.form-input {
  width: 100%;
  height: 48px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  padding: 0 16px;
  font-size: 16px;
  background: var(--bg);
  color: var(--fg);
  transition: var(--transition);
  font-family: inherit;
}

.form-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px var(--primary-glow);
}

.form-row {
  display: flex;
  gap: 12px;
}

.form-row .form-group {
  flex: 1;
}

/* Buttons */
.btn {
  width: 100%;
  height: 52px;
  border: none;
  border-radius: var(--radius-sm);
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: var(--transition);
  font-family: inherit;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  color: white;
  box-shadow: 0 4px 16px var(--primary-glow);
}

.btn-primary:active {
  transform: scale(0.98);
}

.btn-secondary {
  background: var(--bg-card);
  color: var(--fg);
  border: 1px solid var(--border);
}

/* Weight Buttons */
.weight-btns {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 8px;
}

.weight-btn {
  padding: 10px 16px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.weight-btn.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.weight-btn:active {
  transform: scale(0.95);
}

/* Result Box */
.result-box {
  background: linear-gradient(135deg, var(--bg-card) 0%, rgba(99, 102, 241, 0.1) 100%);
  border: 1px solid var(--primary);
  border-radius: var(--radius);
  padding: 24px;
  text-align: center;
}

.result-score {
  font-size: 48px;
  font-weight: 900;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.result-grade {
  font-size: 24px;
  font-weight: 800;
  margin-top: 8px;
}

.grade-A { color: var(--accent-green); }
.grade-B { color: #22d3ee; }
.grade-C { color: var(--accent-orange); }
.grade-D { color: #f97316; }
.grade-E { color: var(--accent-red); }

.result-info {
  margin-top: 16px;
  font-size: 14px;
  color: var(--fg-secondary);
  line-height: 1.8;
}

/* Meal Styles */
.date-tab {
  flex: 1;
  padding: 10px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg-secondary);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  text-align: center;
}

.date-tab.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.meal-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}

.meal-tab {
  flex: 1;
  padding: 12px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg-secondary);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  text-align: center;
}

.meal-tab.active {
  background: var(--accent-green);
  color: white;
  border-color: var(--accent-green);
}

.meal-tab.breakfast.active {
  background: var(--accent-orange);
  border-color: var(--accent-orange);
}

.meal-tab.dinner.active {
  background: var(--accent-purple);
  border-color: var(--accent-purple);
}

.meal-content {
  background: var(--bg);
  border-radius: var(--radius-sm);
  padding: 20px;
  min-height: 150px;
}

.meal-item {
  padding: 10px 0;
  border-bottom: 1px dashed var(--border);
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.meal-item:last-child {
  border-bottom: none;
}

.meal-item::before {
  content: 'â€¢';
  color: var(--accent-green);
  font-weight: bold;
}

.meal-empty {
  text-align: center;
  color: var(--fg-muted);
  padding: 40px 20px;
}

.meal-school-info {
  background: var(--bg);
  border-radius: var(--radius-sm);
  padding: 12px 16px;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.meal-school-icon {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  background: linear-gradient(135deg, var(--accent-green), var(--secondary));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.meal-school-name {
  font-weight: 700;
  font-size: 15px;
}

.meal-school-date {
  font-size: 12px;
  color: var(--fg-muted);
  margin-top: 2px;
}

/* Install Guide Styles */
.install-step {
  display: flex;
  gap: 16px;
  padding: 20px;
  background: var(--bg);
  border-radius: var(--radius-sm);
  margin-bottom: 12px;
}

.install-step-num {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 14px;
  flex-shrink: 0;
}

.install-step-content {
  flex: 1;
}

.install-step-title {
  font-weight: 700;
  font-size: 15px;
  margin-bottom: 4px;
}

.install-step-desc {
  font-size: 13px;
  color: var(--fg-secondary);
  line-height: 1.6;
}

.install-note {
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1));
  border: 1px solid var(--primary);
  border-radius: var(--radius-sm);
  padding: 16px;
  margin-top: 20px;
}

.install-note-title {
  font-weight: 700;
  font-size: 14px;
  color: var(--primary);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.install-note-desc {
  font-size: 13px;
  color: var(--fg-secondary);
  line-height: 1.6;
}

/* History Table */
.history-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

.history-table th {
  padding: 12px 8px;
  text-align: left;
  color: var(--fg-muted);
  font-weight: 600;
  border-bottom: 1px solid var(--border);
}

.history-table td {
  padding: 12px 8px;
  border-bottom: 1px solid var(--border);
}

.history-table tr:last-child td {
  border-bottom: none;
}

.delete-btn {
  color: var(--accent-red);
  cursor: pointer;
  font-weight: 600;
}

/* Subject Guide */
.subject-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px;
  background: var(--bg);
  border-radius: var(--radius-sm);
  margin-bottom: 8px;
  cursor: pointer;
  transition: var(--transition);
}

.subject-item:hover {
  background: var(--bg-card-hover);
}

.subject-item:active {
  transform: scale(0.98);
}

.subject-name {
  font-weight: 600;
  font-size: 15px;
}

.subject-weights {
  font-size: 12px;
  color: var(--fg-muted);
  margin-top: 4px;
}

.subject-arrow {
  color: var(--fg-muted);
  font-size: 18px;
}

/* Modal */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  display: none;
  justify-content: center;
  align-items: flex-end;
  z-index: 1000;
  padding: 20px;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: var(--bg-card);
  border-radius: var(--radius) var(--radius) 0 0;
  padding: 24px;
  width: 100%;
  max-width: 500px;
  max-height: 80vh;
  overflow-y: auto;
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from { transform: translateY(100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.modal-title {
  font-size: 18px;
  font-weight: 700;
}

.modal-close {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: none;
  background: var(--bg);
  color: var(--fg);
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Scroll Styling */
::-webkit-scrollbar {
  width: 4px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--border-light);
  border-radius: 4px;
}

/* Animation */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.animate-in {
  animation: fadeIn 0.4s ease forwards;
}

.delay-1 { animation-delay: 0.1s; opacity: 0; }
.delay-2 { animation-delay: 0.2s; opacity: 0; }
.delay-3 { animation-delay: 0.3s; opacity: 0; }
.delay-4 { animation-delay: 0.4s; opacity: 0; }
</style>
</head>
<body data-theme="dark">

<div class="app-container">
  <!-- Header -->
  <header class="header">
    <div>
      <div class="header-title">ë©”ì¹´ 4ë°˜</div>
      <div class="header-subtitle">êµ­ë¦½êµ¬ë¯¸ì „ìê³µì—…ê³ ë“±í•™êµ</div>
    </div>
    <button class="theme-btn" id="themeBtn">ğŸŒ™</button>
  </header>

  <!-- Page Container -->
  <div class="page-container">
    
    <!-- Home Page -->
    <div class="page active" id="page-home">
      <div class="home-hero animate-in">
        <div class="home-logo">ë©”ì¹´</div>
        <div class="home-title">ë©”ì¹´ 4ë°˜</div>
        <div class="home-desc">ìš°ë¦¬ ë°˜ì„ ìœ„í•œ ì¢…í•© ë„ìš°ë¯¸</div>
      </div>

      <div class="menu-grid">
        <div class="menu-item animate-in delay-1" onclick="goToPage('install')">
          <div class="menu-icon blue">ğŸ“²</div>
          <div class="menu-name">ì•± ì„¤ì¹˜</div>
          <div class="menu-desc">í™ˆ í™”ë©´ì— ì¶”ê°€</div>
        </div>
        <div class="menu-item animate-in delay-2" onclick="goToPage('grade')">
          <div class="menu-icon purple">ğŸ“Š</div>
          <div class="menu-name">ì„±ì  ê³„ì‚°ê¸°</div>
          <div class="menu-desc">ë“±ê¸‰ ê³„ì‚°</div>
        </div>
        <div class="menu-item animate-in delay-3" onclick="goToPage('average')">
          <div class="menu-icon green">ğŸ“ˆ</div>
          <div class="menu-name">í‰ê·  ê³„ì‚°ê¸°</div>
          <div class="menu-desc">ê³¼ëª© í‰ê· </div>
        </div>
        <div class="menu-item animate-in delay-4" onclick="goToPage('meal')">
          <div class="menu-icon orange">ğŸ½ï¸</div>
          <div class="menu-name">ì˜¤ëŠ˜ì˜ ê¸‰ì‹</div>
          <div class="menu-desc">ê¸‰ì‹ ë©”ë‰´</div>
        </div>
      </div>
    </div>

    <!-- Install Guide Page -->
    <div class="page" id="page-install">
      <div class="card">
        <div class="card-title">
          <div class="card-title-icon" style="background: linear-gradient(135deg, #3b82f6, #6366f1);">ğŸ“²</div>
          ì•± ì„¤ì¹˜ ë°©ë²•
        </div>
        
        <div class="install-step">
          <div class="install-step-num">1</div>
          <div class="install-step-content">
            <div class="install-step-title">ê³µìœ  ë²„íŠ¼ ëˆ„ë¥´ê¸°</div>
            <div class="install-step-desc">Safari í•˜ë‹¨ì˜ ê³µìœ  ë²„íŠ¼(â–¡â†‘)ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”. AndroidëŠ” Chrome ë©”ë‰´(â‹®)ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
          </div>
        </div>

        <div class="install-step">
          <div class="install-step-num">2</div>
          <div class="install-step-content">
            <div class="install-step-title">í™ˆ í™”ë©´ì— ì¶”ê°€</div>
            <div class="install-step-desc">"í™ˆ í™”ë©´ì— ì¶”ê°€" ë˜ëŠ” "ì•± ì„¤ì¹˜" ë²„íŠ¼ì„ ì°¾ì•„ì„œ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
          </div>
        </div>

        <div class="install-step">
          <div class="install-step-num">3</div>
          <div class="install-step-content">
            <div class="install-step-title">ì¶”ê°€ ì™„ë£Œ</div>
            <div class="install-step-desc">"ì¶”ê°€" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í™ˆ í™”ë©´ì— ì•± ì•„ì´ì½˜ì´ ìƒì„±ë©ë‹ˆë‹¤!</div>
          </div>
        </div>

        <div class="install-note">
          <div class="install-note-title">ğŸ’¡ Tip</div>
          <div class="install-note-desc">
            í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ë©´ ì•±ì²˜ëŸ¼ ì „ì²´ í™”ë©´ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ë” ë¹ ë¥´ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆì–´ìš”!
          </div>
        </div>
      </div>
    </div>

    <!-- Grade Calculator Page -->
    <div class="page" id="page-grade">
      <div class="card">
        <div class="card-title">
          <div class="card-title-icon" style="background: linear-gradient(135deg, #a855f7, #ec4899);">ğŸ“Š</div>
          ì„±ì  ê³„ì‚°ê¸°
        </div>

        <div class="form-group">
          <label class="form-label">ê³¼ëª©ëª…</label>
          <input type="text" class="form-input" id="subjectName" placeholder="ì˜ˆ: ìë£Œêµ¬ì¡°">
        </div>

        <button class="btn btn-secondary" style="margin-bottom: 16px;" onclick="openSubjectModal()">
          ğŸ“‹ ê³¼ëª©ë³„ ë¹„ì¤‘ ë¶ˆëŸ¬ì˜¤ê¸°
        </button>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ìˆ˜í–‰í‰ê°€ ê°œìˆ˜</label>
            <input type="number" class="form-input" id="sCount" value="2" min="1" onchange="generateGradeInputs()">
          </div>
          <div class="form-group">
            <label class="form-label">ì§€í•„í‰ê°€ ê°œìˆ˜</label>
            <input type="number" class="form-input" id="tCount" value="2" min="1" max="2" onchange="generateGradeInputs()">
          </div>
        </div>
      </div>

      <div class="card" id="performanceBox"></div>
      <div class="card" id="examBox"></div>

      <button class="btn btn-primary" onclick="calculateGrade()">ê³„ì‚°í•˜ê¸°</button>

      <div class="card" id="gradeResult" style="display: none; margin-top: 16px;">
        <div class="result-box">
          <div class="result-score" id="resultScore">0</div>
          <div class="result-grade" id="resultGrade">-</div>
          <div class="result-info" id="resultInfo"></div>
        </div>
      </div>

      <div class="card" style="margin-top: 16px;">
        <div class="card-title" style="justify-content: space-between;">
          <span>ğŸ“ ê³„ì‚° ê¸°ë¡</span>
          <button class="delete-btn" onclick="clearHistory()">ì „ì²´ ì‚­ì œ</button>
        </div>
        <div style="overflow-x: auto;">
          <table class="history-table">
            <thead>
              <tr>
                <th>ê³¼ëª©</th>
                <th>ì ìˆ˜</th>
                <th>ë“±ê¸‰</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="historyBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Average Calculator Page -->
    <div class="page" id="page-average">
      <div class="card">
        <div class="card-title">
          <div class="card-title-icon" style="background: linear-gradient(135deg, #10b981, #22d3ee);">ğŸ“ˆ</div>
          í‰ê·  ê³„ì‚°ê¸°
        </div>

        <div class="form-group">
          <label class="form-label">ê³¼ëª© ê°œìˆ˜</label>
          <input type="number" class="form-input" id="avgSubjectCount" placeholder="ê³¼ëª© ê°œìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”" min="1" max="20">
        </div>

        <button class="btn btn-primary" onclick="generateAvgInputs()">ë‹¤ìŒ</button>
      </div>

      <div class="card" id="avgInputsCard" style="display: none;">
        <div class="card-title">ì ìˆ˜ ì…ë ¥</div>
        <div id="avgInputsContainer"></div>
        <button class="btn btn-primary" onclick="calculateAvg()">í‰ê·  ê³„ì‚°í•˜ê¸°</button>
      </div>

      <div class="card" id="avgResultCard" style="display: none;">
        <div class="result-box">
          <div style="font-size: 14px; color: var(--fg-secondary); margin-bottom: 8px;">ì „ì²´ í‰ê· </div>
          <div class="result-score" id="avgResultScore">0</div>
        </div>
        <button class="btn btn-secondary" style="margin-top: 16px;" onclick="resetAvg()">ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°</button>
      </div>
    </div>

    <!-- Meal Page -->
    <div class="page" id="page-meal">
      <div class="card">
        <div class="card-title">
          <div class="card-title-icon" style="background: linear-gradient(135deg, #f59e0b, #ef4444);">ğŸ½ï¸</div>
          ì˜¤ëŠ˜ì˜ ê¸‰ì‹
        </div>

        <div class="meal-school-info">
          <div class="meal-school-icon">ğŸ«</div>
          <div>
            <div class="meal-school-name">êµ­ë¦½êµ¬ë¯¸ì „ìê³µì—…ê³ ë“±í•™êµ</div>
            <div class="meal-school-date" id="mealDate"></div>
          </div>
        </div>

        <div class="meal-tabs" style="margin-bottom: 12px;">
          <button class="date-tab active" data-offset="0" onclick="changeDate(0)">ì˜¤ëŠ˜</button>
          <button class="date-tab" data-offset="1" onclick="changeDate(1)">ë‚´ì¼</button>
        </div>

        <div class="meal-tabs">
          <button class="meal-tab breakfast" onclick="changeMeal('breakfast')">ì¡°ì‹</button>
          <button class="meal-tab lunch active" onclick="changeMeal('lunch')">ì¤‘ì‹</button>
          <button class="meal-tab dinner" onclick="changeMeal('dinner')">ì„ì‹</button>
        </div>

        <div class="meal-content" id="mealContent">
          <div class="meal-empty">ê¸‰ì‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
      </div>
    </div>

  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <button class="nav-item active" onclick="goToPage('home')">
      <span class="nav-icon">ğŸ </span>
      <span class="nav-label">í™ˆ</span>
    </button>
    <button class="nav-item" onclick="goToPage('grade')">
      <span class="nav-icon">ğŸ“Š</span>
      <span class="nav-label">ì„±ì </span>
    </button>
    <button class="nav-item" onclick="goToPage('average')">
      <span class="nav-icon">ğŸ“ˆ</span>
      <span class="nav-label">í‰ê· </span>
    </button>
    <button class="nav-item" onclick="goToPage('meal')">
      <span class="nav-icon">ğŸ½ï¸</span>
      <span class="nav-label">ê¸‰ì‹</span>
    </button>
  </nav>
</div>

<!-- Subject Modal -->
<div class="modal" id="subjectModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">ê³¼ëª©ë³„ ë¹„ì¤‘</div>
      <button class="modal-close" onclick="closeSubjectModal()">Ã—</button>
    </div>
    <div id="subjectList"></div>
  </div>
</div>

<script>
// ========== 12ì›” ê¸‰ì‹ ë°ì´í„° (ìˆ˜ë™) ==========
const MEAL_DATABASE = {
  '20251212': {
    breakfast: ['í°ë°¥', 'ì‡ ê³ ê¸°ë‘ë¶€êµ­', 'ì•¼ì±„ê³„ë€ì°œ', 'ì¹¼ì§‘ë¹„ì—”ë‚˜ì¼€ì°¹ë³¶ìŒ', 'ë‹­ë‹¤ë¦¬ì‚´ìŠ¤í…Œì´í¬', 'ë°°ì¶”ê¹€ì¹˜', 'ë‘¥ì‹¤ì°¹ìŒ€ë–¡', 'ë¸ëª¬íŠ¸ì¥¬ìŠ¤'],
    lunch: ['ì°¨ìˆ˜ìˆ˜ë°¥', 'ë‹¬ì½¤ë‹¨í˜¸ë°•ì£½', 'ì˜›ë‚ ì°°ìˆœëŒ€êµ­', 'ë¹…í˜íŒŒë¡ í­ë¦½', 'ì‹œê¸ˆì¹˜ë¬´ì¹¨', 'ë°°ì¶”ê¹€ì¹˜', 'í´ë˜ì‹ê°¸ë˜ì‡¼ì½œë¼', 'í˜¼í•©ìŒë£Œ'],
    dinner: null
  },
  '20251213': { breakfast: null, lunch: null, dinner: null }, // í† ìš”ì¼
  '20251214': { breakfast: null, lunch: null, dinner: null }, // ì¼ìš”ì¼
  '20251215': {
    breakfast: ['í°ë°¥', 'ì‡ ê³ ê¸°ë¯¸ì—­êµ­', 'ì¶˜ì²œë‹­ê°ˆë¹„', 'ì•¼ì±„ê³„ë€ë§ì´', 'ë°°ì¶”ê¹€ì¹˜', 'ì´ˆì½”ì¸„ì´ìŠ¤ë§ë„ë„›', 'ì•¼ì¿ ë¥´íŠ¸/í‚¤ì§±'],
    lunch: ['ë…¸ë‘ì°¨ì¡°ë°¥', 'ë¼ì§€ë“±ë¼ˆê°ìíƒ•', 'ë¸Œë¡œì½œë¦¬ì´ˆíšŒ', 'í›ˆì œì˜¤ë¦¬ìˆ™ì£¼ë³¶ìŒ', 'í¬ëŸ¼ë¸”í¬ëŸ°ì¹˜í‚¨', 'ë°°ì¶”ê¹€ì¹˜', 'ì´ˆì½”íë‹¹ë°”ë‚˜ë‚˜ë¹µ', 'ì¹œí™˜ê²½ë©œë¡ ', 'ì•¼ì¿ ë¥´íŠ¸ì œë¡œ'],
    dinner: ['í˜¼í•©ì¡ê³¡ë°¥', 'ê°ìê³ ì¶”ì¥ì°Œê°œ', 'ì½©ë‚˜ë¬¼ë§¤ì½¤ë¬´ì¹¨', 'ì˜¤ì‚¼ë¶ˆê³ ê¸°', 'í†µì‚´ì§€íŒŒì´', 'ë°°ì¶”ê¹€ì¹˜', 'êµ¬ë¦„í¬ë ˆì»¤', 'ì¥¬ì‹œì¿¨']
  },
  '20251216': {
    breakfast: ['í°ë°¥', 'ì‡ ê³ ê¸°ë¯¸ì—­êµ­', 'ì¶˜ì²œë‹­ê°ˆë¹„', 'ì•¼ì±„ê³„ë€ë§ì´', 'ë°°ì¶”ê¹€ì¹˜', 'ì´ˆì½”ì¸„ì´ìŠ¤ë§ë„ë„›', 'ì•¼ì¿ ë¥´íŠ¸/í‚¤ì§±'],
    lunch: ['í˜¼í•©ì¡ê³¡ë°¥', 'ëª¨ë“¬ì–´ë¬µêµ­', 'ìˆ¯ë¶ˆì–‘ë…ìª¼ë¦¼ë‹­', 'ì–‘ë…ê¹»ì', 'ì«„ë©´ì•¼ì±„ë¬´ì¹¨', 'ë°°ì¶”ê¹€ì¹˜', 'ë¶•ì–´ë¹µ/íŒ¥', 'ë„ë„›ì•„ì´ìŠ¤í¬ë¦¼'],
    dinner: ['í°ë°¥', 'ê¹€ì¹˜ìˆœë‘ë¶€ì°Œê°œ', 'ë„í† ë¦¬ë¬µ/ì–‘ë…ì¥', 'ë¶ˆë‹­ì´ì•¼í•¨ë°•ì´ì•¼', 'ìŠ¤íŒ¸êµ¬ì´/ì¼€ì°¹', 'ë°°ì¶”ê¹€ì¹˜', 'í”¼í¬ë‹‰']
  },
  '20251217': {
    breakfast: ['ê¹€ì¹˜ì¹˜ì¦ˆêµ¬ìš´ì£¼ë¨¹ë°¥', 'ì‡ ê³ ê¸°ì•¼ì±„ì£½', 'ì‚¼ìƒ‰ì†Œì‹œì§€ìƒˆì†¡ì´ë³¶ìŒ', 'ë°°ì¶”ê¹€ì¹˜', 'ì‹œë¦¬ì–¼/ìš°ìœ (ì´ˆì½”ì²µìŠ¤)', 'êµ¬ìŠ¬ë–¡'],
    lunch: ['í˜¼í•©ì¡ê³¡ë°¥', 'ì²­ì–‘ê³ ì¶”ëœì¥ì°Œê°œ', 'ë¹„ë²•ì¥ëŒ€íŒŒì¡±ë°œ', 'ëª¨ë“¬ì•¼ì±„ì˜¤ë¦¬ì—”íƒˆì†ŒìŠ¤ìƒëŸ¬ë“œ', 'ê³„ë€ì…íŒì—ê·¸ë‘ë•¡', 'ë°°ì¶”ê¹€ì¹˜', 'í™”ê³¼ë°©ìš°ë¦¬ìŒ€ì‚¬ê³¼ë§Œì£¼', 'ì œì£¼ìƒ˜ë¬¼ëª©ì¥ìš”ê±°íŠ¸'],
    dinner: ['ë¶ˆê³ ê¸°ê¹€ì¹˜ë¼ì´ìŠ¤ë²„ê±°', 'ìœ ë¶€ìš°ë™êµ­', 'í˜¼í•©ë©¸ì¹˜ë³¶ìŒ', 'ë°°ì¶”ê¹€ì¹˜', 'ì•™ë²„í„°ì ˆí¸', 'ë¸ëª¬íŠ¸ì¥¬ìŠ¤']
  },
  '20251218': {
    breakfast: ['í°ë°¥', 'ë°°ì¶”ëœì¥êµ­', 'ìš°ì‚¼ê²¹ìˆ™ì£¼ë³¶ìŒ', 'ë‚¨í•´ë§ˆëŠ˜í•˜íŠ¸ë¯¸ë‹ˆí•¨ë°•', 'í†µì‚´ê°€ë“ìˆœì‚´ì¹˜í‚¨', 'ë°°ì¶”ê¹€ì¹˜', 'ìš°ìœ ë¡¤ì¼€ì´í¬', 'ì•¼ì¿ ë¥´íŠ¸/ì—”ìš”í”Œë ˆì¸'],
    lunch: ['ì••ë§¥ë°¥', 'í•œìš°ë‚˜ì£¼ê³°íƒ•', 'íƒ•í‰ì±„', 'ì±„ì–´ë¬µë³¶ìŒ', 'ë‚¨ë„ë–¡ê°ˆë¹„êµ¬ì´', 'ì„ë°•ì§€', 'ì™€ê·œë¶ˆê³ ê¸°í”¼ì', 'ì¹œí™˜ê²½ê°ê·¤', 'ì•„ì¹¨ì—ì¥¬ìŠ¤'],
    dinner: ['í˜¼í•©ì¡ê³¡ë°¥', 'ê·¼ëŒ€ëœì¥êµ­', 'ì•¼ì±„ê³„ë€ì°œ', 'ì™•ëˆê¹ŒìŠ¤&ì†ŒìŠ¤', 'ë”ë¸”í†µí†µìƒˆìš°ê¼¬ì¹˜', 'ë°°ì¶”ê¹€ì¹˜', 'ì•¼ì¿ ë¥´íŠ¸ì œë¡œ', 'ìš°ìœ í¬ë¦¼íŒì½˜']
  },
  '20251219': {
    breakfast: ['í°ë°¥', 'ê°ììˆ˜ì œë¹„êµ­', 'ë‹­ê³ ê¸°ë‹¨í˜¸ë°•ì¡°ë¦¼', 'ëª…ì—½ì±„ë³¶ìŒ', 'ìŠ¤íŒ¸êµ¬ì´/ì¼€ì°¹', 'ë°°ì¶”ê¹€ì¹˜', 'ê³ ê¸°ì¡ì±„ì°ë¹µ', 'ë°”ë‚˜ë‚˜ë¼ë–¼'],
    lunch: ['ì°¨ìˆ˜ìˆ˜ë°¥', 'ì œì£¼í‘ë¼ì§€ë¬µì€ì§€ê¹€ì¹˜ì°Œê°œ', 'íŒŒê¹€ì¹˜', 'ì¹˜ì»¤ë¦¬ë¶€ì¶”ìƒì±„', 'í•´ë¬¼ë³¶ìŒìš°ë™', 'ì •í†µí™ì¶˜ì²œë‹­ê°ˆë¹„', 'í´ë˜ì‹ê°¸ë˜ì‡¼ì½œë¼', 'í˜¼í•©ìŒë£Œ'],
    dinner: ['í°ë°¥', 'ìœ¡ê°œì¥', 'ë™ì¸ë™ì°œê°ˆë¹„', 'ì˜¤ì´ì–‘íŒŒë¬´ì¹¨', 'ì˜¤ì§•ì–´ê¹€ì¹˜ì „', 'ë°°ì¶”ê¹€ì¹˜', 'ë˜í‚¨ë„ë„›/ë¯¸ë‹ˆí•‘í¬í•˜íŠ¸', 'ì•¼ì¿ ë¥´íŠ¸']
  },
  '20251220': {
    breakfast: ['í–„ê¹€ì¹˜ë³¶ìŒë°¥', 'ë¬´ë‘ë¶€íƒ•êµ­', 'êµìë§Œë‘íŠ€ê¹€', 'ë„ˆë¹„ì•„ë‹ˆêµ¬ì´', 'ë°°ì¶”ê¹€ì¹˜', 'ë ˆëª¬ì¼€ì´í¬', 'ì´ˆì½”ìš°ìœ '],
    lunch: ['í°ë°¥', 'í˜¸ë°•ëœì¥ì°Œê°œ', 'ì½©ë‚˜ë¬¼ë¬´ì¹¨', 'ì œìœ¡ë³¶ìŒ', 'ìœ¡ì›ì „', 'ë°°ì¶”ê¹€ì¹˜', 'í¬ë¦¼ì¹´ìŠ¤í…Œë¼ë¨¸í•€', 'ê³¼ì¼ì¥¬ìŠ¤(ì¿¨í”¼ìŠ¤)', 'ì¹œí™˜ê²½ë”¸ê¸°'],
    dinner: ['ì§œì¥ë°¥', 'ê³„ë€ì‹¤íŒŒêµ­', 'ë‘ë¶€êµ¬ì´ì–‘ë…ì¡°ë¦¼', 'ì½°ì‚­ë¹ ì‚­ìˆœì‚´ì¹˜í‚¨', 'ë°°ì¶”ê¹€ì¹˜', 'ìŠ¤ì½œ/ì‚¬ê³¼ë§›']
  },
  '20251221': {
    breakfast: ['í°ë°¥', 'ì‡ ê³ ê¸°ë‹¹ë©´êµ­', 'ë§¤ì½¤ì–´ë¬µë³¶ìŒ', 'ì˜¤ì‚¼ë¶ˆê³ ê¸°', 'ë©”ë°€ê¹€ì¹˜ì „ë³‘', 'ë°°ì¶”ê¹€ì¹˜', 'ì•½ê³¼ë„ë„›', 'ìŠ¤ì½œ/ì‚¬ê³¼ë§›'],
    lunch: ['í°ë°¥', 'ì°¸ì¹˜ê¹€ì¹˜ì°Œê°œ', 'ì¹´ë ˆì†ŒìŠ¤', 'ìˆ¯ë¶ˆì–‘ë…ìª¼ë¦¼ë‹­', 'êµìë§Œë‘íŠ€ê¹€', 'ë°°ì¶”ê¹€ì¹˜', 'ë‘¥ì‹¤ì°¹ìŒ€ë–¡', 'ì•¼ì¿ ë¥´íŠ¸'],
    dinner: ['í–„ì•¼ì±„ë³¶ìŒë°¥', 'ë§‘ì€ë¯¸ì—­êµ­', 'ìƒì¶”ì¹˜ì»¤ë¦¬ë¬´ì¹¨', 'ë„ì‹œë½ê¹€', 'ë°”ë² íì¹˜í‚¨ê¼¬ì¹˜', 'ë°°ì¶”ê¹€ì¹˜', 'ì´ˆì½”ì¸„ì´ìŠ¤ë§ë„ë„›', 'ê³¼ì¼ì¥¬ìŠ¤(ì¿¨í”¼ìŠ¤)']
  },
  '20251222': {
    breakfast: ['í°ë°¥', 'ë–¡êµ­', 'ë¼ì§€ê°ˆë¹„ì°œ', 'ì—°ë‘ë¶€/ì–‘ë…ì¥', 'ìˆ™ì£¼ë§›ì‚´ë¬´ì¹¨', 'ë°°ì¶”ê¹€ì¹˜', 'ìš°ë¦¬ë°€í†µíŒ¥ì¹¼ìŠ˜ì°ë¹µ', 'ë¬´ê°€ë‹¹ì•¼ì¿ ë¥´íŠ¸'],
    lunch: ['ê°•í™©ìŒ€ë°¥', 'ìƒˆì•ŒíŒ¥ì£½', 'ì²­ì–‘ê³ ì¶”ëœì¥ì°Œê°œ', 'ë¯¸ì—­ì¤„ê¸°ë³¶ìŒ', 'ê°€ìë¯¸íŠ€ê¹€ì–‘ë…', 'LAë¼ì§€ê°ˆë¹„êµ¬ì´', 'ë°°ì¶”ê¹€ì¹˜', 'ì•™ë²„í„°ì ˆí¸', 'ìœ ê¸°ë†ì•¼ì±„ì‚¬ë‘í‚¤ì¦ˆ'],
    dinner: ['í˜¼í•©ì¡ê³¡ë°¥', 'ìœ¡ê°œì¥', 'ì§€ë¦¬ë©¸ì¹˜ì½©ê°•ì •ë³¶ìŒ', 'ë–¡ë³¶ì´/ê¹€ë§ì´', 'ë‚¨ë„ë–¡ê°ˆë¹„êµ¬ì´', 'ë°°ì¶”ê¹€ì¹˜', 'íƒ€ì½”ì•¼ë¼ë³¼ ê¼¬ì¹˜', 'í”¼í¬ë‹‰']
  },
  '20251223': {
    breakfast: ['í°ë°¥', 'ëª¨ë“¬ì–´ë¬µêµ­', 'ê½ˆë¦¬ê³ ì¶”ë©”ì¶”ë¦¬ì•Œì¥ì¡°ë¦¼', 'ê°ìë² ì´ì»¨ë³¶ìŒ', 'ì œì£¼í‘ë¼ì§€ë¶ˆê³ ê¸°', 'ë°°ì¶”ê¹€ì¹˜', 'ë¹„í”¼ë”ìŠ¤', 'ë‹¤í¬ì´ˆì½”ë„›ì¸ '],
    lunch: ['ì½©ë‚˜ë¬¼ë°¥/ì–‘ë…ì¥', 'ì”ì¹˜êµ­ìˆ˜', 'ì¹˜í‚¨ìŠ¤í…Œì´í¬', 'ë°°ì¶”ê¹€ì¹˜', 'ë¬´ë§ë­ì´ê¹€ì¹˜', 'ì—ê·¸íƒ€ë¥´íŠ¸', 'ë¯¸ë‹ˆë©œì¸ êµ¬ìŠ¬ì•„ì´ìŠ¤í¬ë¦¼', 'ì¹œí™˜ê²½í¬ë„(ìƒ¤ì¸ë¨¸ìŠ¤ì¼“)'],
    dinner: ['ì˜¤ë¦¬í›ˆì œì†Œì´í•„ë¼í”„', 'ì‡ ê³ ê¸°ë‘ë¶€íƒ•êµ­', 'ê¾¼ì¥í¬ì±„ë³¶ìŒ', 'ì¹˜í‚¨í…ë”/ì†ŒìŠ¤', 'ë°°ì¶”ê¹€ì¹˜', 'ìš”ê±°íŠ¸', 'ë¸”ë™í¬ë¡œì¹¸ìŠˆ']
  },
  '20251224': {
    breakfast: ['í°ë°¥', 'ì‡ ê³ ê¸°ë‘ë¶€êµ­', 'ì•¼ì±„ê³„ë€ì°œ', 'íŒŒë˜ìë°˜ë³¶ìŒ', 'í›ˆì œì˜¤ë¦¬ê°ìë³¶ìŒ', 'ë°°ì¶”ê¹€ì¹˜', 'ìš”ê±°ì–Œì–Œìš”êµ¬ë¥´íŠ¸', 'ìš°ë¦¬ì°¹ìŒ€íŒ¥ê½ˆë°°ê¸°ë„ë„›'],
    lunch: ['í˜¼í•©ì¡ê³¡ë°¥', 'ì‡ ê³ ê¸°ë¯¸ì—­êµ­', 'ë‘ë¶€êµ¬ì´ì–‘ë…ì¡°ë¦¼', 'ëª¨ë“¬ì•¼ì±„ì˜¤ë¦¬ì—”íƒˆì†ŒìŠ¤ìƒëŸ¬ë“œ', 'ì–‘ë…ê¹»ì', 'ì˜¤ë¸ì§í™”í•œë§ˆë¦¬í†µë‹­', 'ë°°ì¶”ê¹€ì¹˜', 'ë¸Œë¼ìš°ë‹ˆì¼€ìµ', 'ë°€í‚¤ì†Œë‹¤'],
    dinner: ['í°ë°¥', 'ë‘ë¶€ê°ìê³ ì¶”ì¥ì°Œê°œ', 'ì˜¤ì§•ì–´ì‹¤ì±„ë¬´ì¹¨', 'í•´ë¬¼ë³¶ìŒìš°ë™', 'ì„êº½ì •ë–¡ê°ˆë¹„', 'ë°°ì¶”ê¹€ì¹˜', 'í¬ë¦¼í’ˆì€ë°”ì›€ì¿ í—¨', 'ê³¼ì±„ì•¼ì±„í•©ì²´']
  },
  '20251225': {
    breakfast: ['íŒŒê¸°ë¦„ë¶ˆê³ ê¸°ì£¼ë¨¹ë°¥', 'ì˜ì–‘ë‹­ì£½', 'í”¼ë§ë–¡ê°ˆë¹„ì¡°ë¦¼', 'ë°°ì¶”ê¹€ì¹˜', 'ì‹œë¦¬ì–¼/ìš°ìœ (ì˜¤ë ˆì˜¤ì˜¤ì¦ˆ)', 'ë ˆëª¬ì¼€ì´í¬'],
    lunch: ['ë…¸ë‘ì°¨ì¡°ë°¥', 'ìŠ¤íŒ¸ë¶€ëŒ€ì°Œê°œ', 'ì—°ê·¼ì¡°ë¦¼', 'í—ˆë¸Œì†”íŠ¸ëª¨ë“¬êµ¬ì´', 'ë°°ì¶”ê¹€ì¹˜', 'ê³ ê¸°ì¡ì±„ì°ë¹µ', 'ìƒì¶”ìŒˆ&ìŒˆì¥', 'ìš°ìœ í¬ë¦¼íŒì½˜', 'ì¥¬ì‹œì¿¨'],
    dinner: ['í˜¼í•©ì¡ê³¡ë°¥', 'ë§Œë‘êµ­', 'ê°ìë² ì´ì»¨ì¡°ë¦¼', 'ë™ì¸ë™ë‹­ê°ˆë¹„', 'ë„ˆë¹„ì•„ë‹ˆêµ¬ì´', 'ë°°ì¶”ê¹€ì¹˜', 'ë©”ì´í”Œí”¼ì¹¸íŒŒì´', 'ì˜¤ë¼ë–¼ìº”']
  },
  '20251226': {
    breakfast: ['í°ë°¥', 'ì‡ ê³ ê¸°êµ­', 'ë¼ìš´ë“œí–„ì¡°ë¦¼', 'ì•ˆë™ì°œë‹­(í† ë§‰)', 'ì˜¤ì´ì–‘íŒŒë¬´ì¹¨', 'ë°°ì¶”ê¹€ì¹˜', 'ìš°ë¦¬ë°€ì´ˆì½”íŒŒì´', 'í”¼í¬ë‹‰'],
    lunch: ['ì••ë§¥ë°¥', 'ë¼ì§€ë“±ë¼ˆê°ìíƒ•', 'ì‹œê¸ˆì¹˜ì¡ì±„', 'ì²­ì–‘ê³ ì¶”ì†¡ì†¡ë–¡ê°ˆë¹„', 'ë°°ì¶”ê¹€ì¹˜', 'ë¶ˆë‹­ë³¶ìŒê¼¬ê¼¬ì¹˜í‚¨', 'ì´ˆì½”íë‹¹ë°”ë‚˜ë‚˜ë¹µ', 'ì¹œí™˜ê²½ë©œë¡ ', 'í˜¼í•©ìŒë£Œ'],
    dinner: ['í°ë°¥', 'ì–¼í°ì§¬ë½•ë¼ë©´', 'ë§ˆëŠ˜ì«‘ì§„ë¯¸ì±„ë¬´ì¹¨', 'í•œì…ë‹¨ë¬´ì§€ë¬´ì¹¨', 'ë°°ì¶”ê¹€ì¹˜', 'ìš”ê±°í†¡ì´ˆì½”ë³¼&í¬ëŸ°ì¹˜', 'ë°”ì‚­ì–‘ë…ë‹­ê°•ì •']
  },
  '20251227': {
    breakfast: ['í°ë°¥', 'ìˆœë‘ë¶€ì°Œê°œ', 'ìˆ™ì£¼ë‚˜ë¬¼ë¬´ì¹¨', 'ë¶ˆí–¥ê³ ì¶”ì¥ë¶ˆê³ ê¸°', 'í†µì‚´ì§€íŒŒì´', 'ë°°ì¶”ê¹€ì¹˜', 'í¬ë¦¼íŠ¸ìœ„ìŠ¤íŠ¸ê½ˆë°°ê¸°', 'ê³¼ì¼ì¥¬ìŠ¤'],
    lunch: ['í’ìë„¤ë¶ˆë‹­ë§ˆìš”ë®ë°¥', 'ê³„ë€ì‹¤íŒŒêµ­', 'ë“±ì‹¬ëˆê¹ŒìŠ¤&ì†ŒìŠ¤', 'ë¶ˆë‹­ì¹˜ì¦ˆê³ ë¡œì¼€', 'ë°°ì¶”ê¹€ì¹˜', 'ì–‘ë°°ì¶”ì½˜ìƒëŸ¬ë“œ', 'ì•¼ì¿ ë¥´íŠ¸/í‚¤ì§±'],
    dinner: ['ë§ˆíŒŒë‘ë¶€ë®ë°¥', 'í˜¸ë°•ëœì¥ì°Œê°œ', 'ì§€ì½”ë°”ìˆ¯ë¶ˆë°”ë² í', 'ë°°ì¶”ê¹€ì¹˜', 'ë¶ˆê³ ê¸°í¬ì¼“ë¸Œë ˆë“œ', 'ë¬´ê°€ë‹¹ì•¼ì¿ ë¥´íŠ¸']
  },
  '20251228': {
    breakfast: ['í•˜ì´ë¼ì´ìŠ¤', 'ìœ ë¶€ê³„ë€êµ­', 'ìš°ì‚¼ê²¹ìˆ™ì£¼ë³¶ìŒ', 'ë‚¨í•´ë§ˆëŠ˜í•˜íŠ¸ë¯¸ë‹ˆí•¨ë°•', 'ë°°ì¶”ê¹€ì¹˜', 'êµ¬ìŠ¬ë–¡', 'í—ˆë‹ˆë”ë¸”(ìš”êµ¬ë¥´íŠ¸)'],
    lunch: ['í°ë°¥', 'ì‡ ê³ ê¸°íƒ•êµ­', 'ì˜¤ì´ìŠ¤í‹±ë¬´ì¹¨', 'ì¶”ì–µì˜ê²½ì–‘ì‹ëˆê¹ŒìŠ¤', 'ë‚¨í•´ë§ˆëŠ˜í•˜íŠ¸ë¯¸ë‹ˆí•¨ë°•', 'ë°°ì¶”ê¹€ì¹˜', 'í¬ë¦¼ì¹´ìŠ¤í…Œë¼ë¨¸í•€', 'ê³¼ì¼ì¥¬ìŠ¤(ì¿¨í”¼ìŠ¤)'],
    dinner: ['ë°ë¦¬ì•¼ë¼ì¹˜í‚¨ë®ë°¥', 'ë§‘ì€ì½©ë‚˜ë¬¼êµ­', 'ë“±ì‹¬í‘ì„ìíƒ•ìˆ˜ìœ¡', 'ë©”ë°€ê¹€ì¹˜ì „ë³‘', 'ë°°ì¶”ê¹€ì¹˜', 'í¬ë¦¼íŠ¸ìœ„ìŠ¤íŠ¸ê½ˆë°°ê¸°', 'ì¥¬ì‹œì¿¨']
  },
  '20251229': {
    breakfast: ['í°ë°¥', 'ë°°ì¶”ëœì¥êµ­', 'ë‹­ê³ ê¸°ë‹¨í˜¸ë°•ì¡°ë¦¼', 'ëª…ì—½ì±„ë³¶ìŒ', 'ë°°ì¶”ê¹€ì¹˜', 'ìš°ë¦¬ì°¹ìŒ€íŒ¥ê½ˆë°°ê¸°ë„ë„›', 'ì·¨ì˜ë£¨ê³ ê¸°ì°ë§Œë‘', 'ì´ˆì½”ìš°ìœ '],
    lunch: ['ì°°ê¸°ì¥ë°¥', 'ì²­êµ­ì¥ì°Œê°œ', 'ë¹„ë¹”êµ­ìˆ˜/ì˜¥ìˆ˜ìˆ˜ë©´', 'ë¶ì„±ë¡œì—°íƒ„ë¶ˆê³ ê¸°/ë§¤ì½¤', 'ë‚¨ë„ë–¡ê°ˆë¹„êµ¬ì´', 'ë°°ì¶”ê¹€ì¹˜', 'í”¼í¬ë‹‰', 'í™”ê³¼ë°©ìš°ë¦¬ìŒ€ì‚¬ê³¼ë§Œì£¼'],
    dinner: ['í°ë°¥', 'ëˆìœ¡ê¹€ì¹˜ì°Œê°œ', 'ì•¼ì±„ê³„ë€ë§ì´', 'ë„ì‹œë½ê¹€', 'ì–¸ì–‘ì‹ë¶ˆê³ ê¸°/íŒŒì ˆì´', 'ë°°ì¶”ê¹€ì¹˜', 'ìš°ë¦¬ìŒ€ë¶ˆë‹­ê³ êµ¬ë§ˆí”¼ì', 'ì•¼ì¿ ë¥´íŠ¸/í‚¤ì§±']
  },
  '20251230': {
    breakfast: ['í°ë°¥', 'ë‘ë¶€ê°ìê³ ì¶”ì¥ì°Œê°œ', 'íŒŒë˜ìë°˜ë³¶ìŒ', 'ë§›ìµ¸í‚¹ê¹í’ê¸°', 'ì˜¥ìˆ˜ìˆ˜ì•¼í•¨ë°•ì´ì•¼', 'ë°°ì¶”ê¹€ì¹˜', 'ì´ˆì½”ì¹©íŠ¸ìœ„ìŠ¤íŠ¸ì¿ í‚¤', 'ì•„ì˜¬ë‹¤ë¶€ìŠ¤í„°'],
    lunch: ['í˜¼í•©ì¡ê³¡ë°¥', 'ì˜›ë‚ ì°°ìˆœëŒ€êµ­', 'ì˜¤ì§•ì–´ë¬´ì¹¨íšŒ', 'ì–‘ë…ê¹»ì', 'í¬ëŸ¼ë¸”í¬ëŸ°ì¹˜í‚¨', 'ë°°ì¶”ê¹€ì¹˜', 'ë¶•ì–´ë¹µ/ìŠˆí¬ë¦¼', 'ì•¼ì¿ ë¥´íŠ¸ì œë¡œ', 'ì¹œí™˜ê²½ë”¸ê¸°'],
    dinner: ['í°ë°¥', 'ë§‘ì€ê°ìêµ­', 'ì‚¼ìƒ‰ì†Œì‹œì§€ë¸Œë¡œì½œë¦¬ë³¶ìŒ', 'ëŒ€íŒ¨ë¶ˆê³ ê¸°', 'ìŠ¤íŠ¸ë§ì¹˜ì¦ˆì–´ë¬µë°”', 'ë°°ì¶”ê¹€ì¹˜', 'ê³ ê¸°ì°ë§Œë‘', 'ì˜¤ë¼ë–¼ìº”']
  },
  '20251231': {
    breakfast: ['ì°¸ì¹˜ë§ˆìš”êµ¬ìš´ì£¼ë¨¹ë°¥', 'ì‡ ê³ ê¸°ì•¼ì±„ì£½', 'ì¹˜ì¦ˆë² ì´ì»¨ê°ìê³ ë¡œì¼€', 'ë°°ì¶”ê¹€ì¹˜', 'ì‹œë¦¬ì–¼/ìš°ìœ (ì•„ëª¬ë“œ,ì½”ì½”ë³¼)'],
    lunch: ['ì°°í˜„ë¯¸ë°¥', 'íŒ½ì´ë²„ì„¯ëœì¥êµ­', 'ìˆ™ì„±ë¬µì€ì§€ì°œë‹­', 'ì‹œê¸ˆì¹˜ë¬´ì¹¨', 'íŒŒê¹€ì¹˜', 'í•œì…ë•¡ì´ˆë¶€ì¶”ì „', 'í†µì‚´ìƒˆìš°ê¹ŒìŠ¤', 'ìŠ¤íŒŒí´ë§ë“œë§í¬', 'ìš°ìœ ìƒí¬ë¦¼ì½”ë¥´ë„¤íŒŒì´'],
    dinner: null
  }
};

let currentMealType = 'lunch';
let currentDateOffset = 0; // 0: ì˜¤ëŠ˜, 1: ë‚´ì¼
let mealData = { breakfast: null, lunch: null, dinner: null };

// ========== í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ==========
function goToPage(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  
  document.getElementById('page-' + pageId).classList.add('active');
  
  const navMap = { home: 0, grade: 1, average: 2, meal: 3, install: 0 };
  document.querySelectorAll('.nav-item')[navMap[pageId]].classList.add('active');
  
  if (pageId === 'meal') {
    loadMealData();
  }
}

// ========== í…Œë§ˆ ì „í™˜ ==========
const themeBtn = document.getElementById('themeBtn');
function applyTheme(theme) {
  document.body.dataset.theme = theme;
  localStorage.setItem('theme', theme);
  themeBtn.textContent = theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
}

applyTheme(localStorage.getItem('theme') || 'dark');
themeBtn.onclick = () => applyTheme(document.body.dataset.theme === 'dark' ? 'light' : 'dark');

// ========== ê¸‰ì‹ ê´€ë ¨ ==========
function getDateWithOffset(offset) {
  const date = new Date();
  date.setDate(date.getDate() + offset);
  return date;
}

function formatDateForAPI(date) {
  return `${date.getFullYear()}${String(date.getMonth() + 1).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}`;
}

function formatDisplayDate(date) {
  const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
  return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')} (${days[date.getDay()]})`;
}

// ë‚ ì§œ ë³€ê²½ (ì˜¤ëŠ˜/ë‚´ì¼)
function changeDate(offset) {
  currentDateOffset = offset;
  document.querySelectorAll('.date-tab').forEach(tab => tab.classList.remove('active'));
  document.querySelector(`.date-tab[data-offset="${offset}"]`).classList.add('active');
  loadMealData();
}

function loadMealData() {
  const targetDate = getDateWithOffset(currentDateOffset);
  document.getElementById('mealDate').textContent = formatDisplayDate(targetDate);
  const mealContent = document.getElementById('mealContent');

  // ì£¼ë§ ì²´í¬
  const dayOfWeek = targetDate.getDay();
  if (dayOfWeek === 0 || dayOfWeek === 6) {
    mealContent.innerHTML = '<div class="meal-empty">ğŸ  ì£¼ë§ì—ëŠ” ê¸‰ì‹ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }

  const dateStr = formatDateForAPI(targetDate);
  
  // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê¸‰ì‹ ì •ë³´ ì¡°íšŒ
  if (MEAL_DATABASE[dateStr]) {
    const dbData = MEAL_DATABASE[dateStr];
    mealData = {
      breakfast: dbData.breakfast || null,
      lunch: dbData.lunch || null,
      dinner: dbData.dinner || null
    };
    displayMeal(currentMealType);
  } else {
    mealContent.innerHTML = `
      <div class="meal-empty">
        ğŸ“­ ê¸‰ì‹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤<br>
        <small style="color: var(--fg-muted);">í•´ë‹¹ ë‚ ì§œì˜ ê¸‰ì‹ ë°ì´í„°ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ì–´ìš”</small>
      </div>
    `;
  }
}

function displayMeal(type) {
  const mealContent = document.getElementById('mealContent');
  const menu = mealData[type];

  if (!menu || menu.length === 0) {
    mealContent.innerHTML = '<div class="meal-empty">ê¸‰ì‹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }

  let html = '';
  menu.forEach(item => {
    if (item) {
      html += `<div class="meal-item">${item}</div>`;
    }
  });
  mealContent.innerHTML = html;
}

function changeMeal(type) {
  currentMealType = type;
  document.querySelectorAll('.meal-tab').forEach(tab => tab.classList.remove('active'));
  document.querySelector(`.meal-tab.${type}`).classList.add('active');
  displayMeal(type);
}

// ========== ì„±ì  ê³„ì‚°ê¸° ==========
const defaultSubjects = [
  { name: 'ìë£Œêµ¬ì¡°', sCount: 2, tCount: 2, sWeights: [30, 30], tWeights: [20, 20] },
  { name: 'ì˜ì–´', sCount: 2, tCount: 1, sWeights: [20, 30], tWeights: [50] },
  { name: 'ê¸°ê³„', sCount: 2, tCount: 2, sWeights: [30, 30], tWeights: [20, 20] },
  { name: 'ìë™í™”ì„¤ë¹„', sCount: 2, tCount: 2, sWeights: [30, 30], tWeights: [20, 20] },
  { name: 'ì „ìíšŒë¡œ', sCount: 2, tCount: 2, sWeights: [30, 30], tWeights: [20, 20] },
  { name: 'ì „ê¸°íšŒë¡œ', sCount: 2, tCount: 2, sWeights: [25, 25], tWeights: [20, 30] },
  { name: 'êµ­ì–´', sCount: 2, tCount: 1, sWeights: [20, 30], tWeights: [50] },
  { name: 'ê³µí†µì‚¬íšŒ1', sCount: 2, tCount: 1, sWeights: [30, 30], tWeights: [40] }
];

function loadSubjects() {
  const saved = localStorage.getItem('customSubjects');
  return saved ? JSON.parse(saved) : [...defaultSubjects];
}

function openSubjectModal() {
  const subjects = loadSubjects();
  const list = document.getElementById('subjectList');
  
  list.innerHTML = subjects.map((subj, idx) => {
    const sText = subj.sWeights.map((w, i) => `ìˆ˜í–‰${i + 1} ${w}%`).join(', ');
    const tText = subj.tCount === 1 ? `ê¸°ë§ ${subj.tWeights[0]}%` : `ì¤‘ê°„ ${subj.tWeights[0]}%, ê¸°ë§ ${subj.tWeights[1]}%`;
    
    return `
      <div class="subject-item" onclick="applySubject(${idx})">
        <div>
          <div class="subject-name">${subj.name}</div>
          <div class="subject-weights">${sText} / ${tText}</div>
        </div>
        <span class="subject-arrow">â€º</span>
      </div>
    `;
  }).join('');

  document.getElementById('subjectModal').classList.add('active');
}

function closeSubjectModal() {
  document.getElementById('subjectModal').classList.remove('active');
}

function applySubject(idx) {
  const subjects = loadSubjects();
  const subj = subjects[idx];
  
  document.getElementById('subjectName').value = subj.name;
  document.getElementById('sCount').value = subj.sCount;
  document.getElementById('tCount').value = subj.tCount;
  
  generateGradeInputs();
  
  setTimeout(() => {
    for (let i = 0; i < subj.sCount; i++) {
      const weightInput = document.getElementById(`sw${i}`);
      if (weightInput) {
        weightInput.value = subj.sWeights[i];
        updateWeightBtns(`sw${i}`, subj.sWeights[i]);
      }
    }
    for (let i = 0; i < subj.tCount; i++) {
      const weightInput = document.getElementById(`tw${i}`);
      if (weightInput) {
        weightInput.value = subj.tWeights[i];
        updateWeightBtns(`tw${i}`, subj.tWeights[i]);
      }
    }
  }, 100);
  
  closeSubjectModal();
}

function updateWeightBtns(id, value) {
  const btns = document.querySelectorAll(`[data-weight-id="${id}"]`);
  btns.forEach(btn => {
    btn.classList.toggle('active', parseInt(btn.dataset.value) === value);
  });
}

function selectWeight(id, value, btn) {
  document.getElementById(id).value = value;
  document.querySelectorAll(`[data-weight-id="${id}"]`).forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

function generateGradeInputs() {
  const sCount = parseInt(document.getElementById('sCount').value);
  const tCount = parseInt(document.getElementById('tCount').value);

  const weights = [20, 25, 30, 40, 50];

  let sHTML = '<div class="card-title" style="font-size: 16px;">ìˆ˜í–‰í‰ê°€</div>';
  for (let i = 0; i < sCount; i++) {
    sHTML += `
      <div class="form-group">
        <label class="form-label">ìˆ˜í–‰ ${i + 1} ì ìˆ˜</label>
        <input type="number" class="form-input" id="s${i}" placeholder="ì ìˆ˜ ì…ë ¥">
      </div>
      <div class="form-group">
        <label class="form-label">ë¹„ì¤‘</label>
        <input type="hidden" id="sw${i}">
        <div class="weight-btns">
          ${weights.map(w => `<button type="button" class="weight-btn" data-weight-id="sw${i}" data-value="${w}" onclick="selectWeight('sw${i}', ${w}, this)">${w}%</button>`).join('')}
        </div>
      </div>
    `;
  }
  document.getElementById('performanceBox').innerHTML = sHTML;

  let tHTML = '<div class="card-title" style="font-size: 16px;">ì§€í•„í‰ê°€</div>';
  for (let i = 0; i < tCount; i++) {
    const label = tCount === 1 ? 'ê¸°ë§ê³ ì‚¬' : (i === 0 ? 'ì¤‘ê°„ê³ ì‚¬' : 'ê¸°ë§ê³ ì‚¬');
    tHTML += `
      <div class="form-group">
        <label class="form-label">${label} ì ìˆ˜</label>
        <input type="number" class="form-input" id="t${i}" placeholder="ì ìˆ˜ ì…ë ¥">
      </div>
      <div class="form-group">
        <label class="form-label">ë¹„ì¤‘</label>
        <input type="hidden" id="tw${i}">
        <div class="weight-btns">
          ${weights.map(w => `<button type="button" class="weight-btn" data-weight-id="tw${i}" data-value="${w}" onclick="selectWeight('tw${i}', ${w}, this)">${w}%</button>`).join('')}
        </div>
      </div>
    `;
  }
  document.getElementById('examBox').innerHTML = tHTML;
}

function calculateGrade() {
  const sCount = parseInt(document.getElementById('sCount').value);
  const tCount = parseInt(document.getElementById('tCount').value);
  const subjectName = document.getElementById('subjectName').value.trim() || '-';

  let total = 0;
  let weightSum = 0;
  let finalWeight = 0;
  let finalScore = 0;

  for (let i = 0; i < sCount; i++) {
    const score = parseFloat(document.getElementById(`s${i}`).value) || 0;
    const weight = parseFloat(document.getElementById(`sw${i}`).value) || 0;
    total += score * (weight / 100);
    weightSum += weight;
  }

  for (let i = 0; i < tCount; i++) {
    const score = parseFloat(document.getElementById(`t${i}`).value) || 0;
    const weight = parseFloat(document.getElementById(`tw${i}`).value) || 0;
    if (tCount === 1 || i === tCount - 1) {
      finalWeight = weight / 100;
      finalScore = score;
    }
    total += score * (weight / 100);
    weightSum += weight;
  }

  if (weightSum !== 100) {
    alert(`ì´ ë¹„ì¤‘ì´ 100%ê°€ ì•„ë‹™ë‹ˆë‹¤. (í˜„ì¬: ${weightSum}%)`);
    return;
  }

  total = parseFloat(total.toFixed(2));
  const grade = total >= 90 ? 'A' : total >= 80 ? 'B' : total >= 70 ? 'C' : total >= 60 ? 'D' : 'E';
  
  const nextCut = { A: null, B: 90, C: 80, D: 70, E: 60 }[grade];
  const currCut = { A: 90, B: 80, C: 70, D: 60, E: 0 }[grade];

  let nextMsg = 'ìµœê³  ë“±ê¸‰!';
  if (total === 100) {
    nextMsg = 'ë§Œì !';
  } else if (nextCut) {
    const need = (nextCut - (total - finalScore * finalWeight)) / finalWeight;
    nextMsg = need > 100 ? 'ë¶ˆê°€ëŠ¥' : `ê¸°ë§ ${need.toFixed(1)}ì  í•„ìš”`;
  }

  const drop = (currCut - 0.01 - (total - finalScore * finalWeight)) / finalWeight;
  const dropMsg = drop < 0 ? 'ë–¨ì–´ì§ˆ ë“±ê¸‰ ì—†ìŒ' : `ê¸°ë§ ${drop.toFixed(1)}ì  ì´í•˜ì‹œ í•˜ë½`;

  document.getElementById('resultScore').textContent = total;
  document.getElementById('resultGrade').textContent = grade + 'ë“±ê¸‰';
  document.getElementById('resultGrade').className = 'result-grade grade-' + grade;
  document.getElementById('resultInfo').innerHTML = `
    ì˜¬ë¼ê°ˆ ê¸°ì¤€: ${nextMsg}<br>
    ë–¨ì–´ì§ˆ ê¸°ì¤€: ${dropMsg}
  `;
  document.getElementById('gradeResult').style.display = 'block';

  saveHistory({ subject: subjectName, score: total, grade });
  renderHistory();
}

function loadHistory() {
  return JSON.parse(localStorage.getItem('gradeHistory') || '[]');
}

function saveHistory(entry) {
  const history = loadHistory();
  history.unshift(entry);
  localStorage.setItem('gradeHistory', JSON.stringify(history.slice(0, 20)));
}

function clearHistory() {
  if (confirm('ê¸°ë¡ì„ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    localStorage.removeItem('gradeHistory');
    renderHistory();
  }
}

function deleteHistoryItem(idx) {
  const history = loadHistory();
  history.splice(idx, 1);
  localStorage.setItem('gradeHistory', JSON.stringify(history));
  renderHistory();
}

function renderHistory() {
  const tbody = document.getElementById('historyBody');
  const history = loadHistory();
  
  if (history.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--fg-muted);">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
    return;
  }

  tbody.innerHTML = history.map((h, i) => `
    <tr>
      <td>${h.subject}</td>
      <td>${h.score}</td>
      <td class="grade-${h.grade}">${h.grade}</td>
      <td><span class="delete-btn" onclick="deleteHistoryItem(${i})">ì‚­ì œ</span></td>
    </tr>
  `).join('');
}

// ========== í‰ê·  ê³„ì‚°ê¸° ==========
function generateAvgInputs() {
  const count = parseInt(document.getElementById('avgSubjectCount').value);
  
  if (!count || count < 1 || count > 20) {
    alert('1~20 ì‚¬ì´ì˜ ê³¼ëª© ê°œìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }

  let html = '';
  for (let i = 0; i < count; i++) {
    html += `
      <div class="form-group">
        <label class="form-label">ê³¼ëª© ${i + 1} ì ìˆ˜</label>
        <input type="number" class="form-input" id="avgScore${i}" placeholder="ì ìˆ˜ ì…ë ¥" min="0" max="100">
      </div>
    `;
  }

  document.getElementById('avgInputsContainer').innerHTML = html;
  document.getElementById('avgInputsCard').style.display = 'block';
  document.getElementById('avgResultCard').style.display = 'none';
  
  setTimeout(() => document.getElementById('avgScore0').focus(), 100);
}

function calculateAvg() {
  const count = parseInt(document.getElementById('avgSubjectCount').value);
  let total = 0;
  let validCount = 0;

  for (let i = 0; i < count; i++) {
    const score = parseFloat(document.getElementById(`avgScore${i}`).value);
    if (!isNaN(score) && score >= 0) {
      total += score;
      validCount++;
    }
  }

  if (validCount === 0) {
    alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }

  const average = (total / validCount).toFixed(2);
  document.getElementById('avgResultScore').textContent = average;
  document.getElementById('avgInputsCard').style.display = 'none';
  document.getElementById('avgResultCard').style.display = 'block';
}

function resetAvg() {
  document.getElementById('avgSubjectCount').value = '';
  document.getElementById('avgInputsCard').style.display = 'none';
  document.getElementById('avgResultCard').style.display = 'none';
}

// ========== ì´ˆê¸°í™” ==========
window.addEventListener('load', () => {
  generateGradeInputs();
  renderHistory();
  document.getElementById('mealDate').textContent = formatDisplayDate();
});

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
document.getElementById('subjectModal').addEventListener('click', (e) => {
  if (e.target.id === 'subjectModal') closeSubjectModal();
});
</script>

</body>
</html>
