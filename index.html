<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ë©”ì¹´ 4ë°˜">
<meta name="theme-color" content="#0a0a0f">
<meta name="mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<title>ë©”ì¹´ 4ë°˜</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

:root {
  --bg: #0a0a0f;
  --bg-secondary: #12121a;
  --bg-card: #1a1a24;
  --bg-card-hover: #22222e;
  --fg: #f0f0f5;
  --fg-secondary: #8a8a95;
  --fg-muted: #5a5a65;
  --primary: #6366f1;
  --primary-glow: rgba(99, 102, 241, 0.3);
  --secondary: #22d3ee;
  --accent-green: #10b981;
  --accent-orange: #f59e0b;
  --accent-red: #ef4444;
  --accent-purple: #a855f7;
  --border: rgba(255, 255, 255, 0.08);
  --border-light: rgba(255, 255, 255, 0.12);
  --shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
  --radius: 16px;
  --radius-sm: 10px;
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

[data-theme="light"] {
  --bg: #f8f9fc;
  --bg-secondary: #ffffff;
  --bg-card: #ffffff;
  --bg-card-hover: #f0f1f5;
  --fg: #1a1a2e;
  --fg-secondary: #6b7280;
  --fg-muted: #9ca3af;
  --border: rgba(0, 0, 0, 0.08);
  --border-light: rgba(0, 0, 0, 0.12);
  --shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
}

html, body {
  height: 100%;
  overflow: hidden;
  touch-action: manipulation;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  overscroll-behavior: none;
}

body {
  font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--fg);
  -webkit-font-smoothing: antialiased;
}

.app-container {
  height: 100%;
  display: flex;
  flex-direction: column;
  max-width: 500px;
  margin: 0 auto;
  background: var(--bg);
  position: relative;
  overflow: hidden;
}

/* Header */
.header {
  padding: 16px 20px;
  padding-top: max(16px, env(safe-area-inset-top));
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 100;
}

.header-title {
  font-size: 20px;
  font-weight: 800;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.header-subtitle {
  font-size: 11px;
  color: var(--fg-muted);
  margin-top: 2px;
}

.theme-btn {
  width: 40px;
  height: 40px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--fg);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  transition: var(--transition);
}

.theme-btn:active {
  transform: scale(0.95);
}

/* Page Container */
.page-container {
  flex: 1;
  overflow: hidden;
  position: relative;
}

.page {
  position: absolute;
  inset: 0;
  overflow-y: auto;
  padding: 20px;
  padding-bottom: 100px;
  opacity: 0;
  transform: translateX(20px);
  pointer-events: none;
  transition: opacity 0.3s ease, transform 0.3s ease;
}

.page.active {
  opacity: 1;
  transform: translateX(0);
  pointer-events: auto;
}

/* Bottom Navigation */
.bottom-nav {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--bg-secondary);
  border-top: 1px solid var(--border);
  padding: 8px 12px;
  padding-bottom: max(8px, env(safe-area-inset-bottom));
  display: flex;
  justify-content: space-around;
  gap: 4px;
  z-index: 100;
}

.nav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 8px 4px;
  border-radius: 12px;
  cursor: pointer;
  transition: var(--transition);
  background: transparent;
  border: none;
  color: var(--fg-muted);
}

.nav-item.active {
  color: var(--primary);
  background: var(--primary-glow);
}

.nav-item:active {
  transform: scale(0.95);
}

.nav-icon {
  font-size: 22px;
  line-height: 1;
}

.nav-label {
  font-size: 10px;
  font-weight: 600;
}

/* Cards */
.card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 16px;
  transition: var(--transition);
}

.card:hover {
  border-color: var(--border-light);
}

.card-title {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.card-title-icon {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
}

/* Home Page Styles */
.home-hero {
  text-align: center;
  padding: 40px 20px;
  background: linear-gradient(180deg, var(--bg-card) 0%, transparent 100%);
  border-radius: var(--radius);
  margin-bottom: 24px;
  position: relative;
  overflow: hidden;
}

.home-hero::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle at center, var(--primary-glow) 0%, transparent 50%);
  animation: pulse 4s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.3; transform: scale(1); }
  50% { opacity: 0.6; transform: scale(1.1); }
}

.home-logo {
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  border-radius: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
  font-weight: 900;
  color: white;
  margin: 0 auto 20px;
  position: relative;
  z-index: 1;
  box-shadow: 0 8px 32px var(--primary-glow);
}

.home-title {
  font-size: 28px;
  font-weight: 900;
  margin-bottom: 8px;
  position: relative;
  z-index: 1;
}

.home-desc {
  font-size: 14px;
  color: var(--fg-secondary);
  position: relative;
  z-index: 1;
}

.menu-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.menu-item {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 24px 16px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
}

.menu-item:hover {
  background: var(--bg-card-hover);
  border-color: var(--border-light);
  transform: translateY(-2px);
}

.menu-item:active {
  transform: scale(0.98);
}

.menu-icon {
  width: 56px;
  height: 56px;
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  margin: 0 auto 12px;
}

.menu-icon.blue { background: linear-gradient(135deg, #3b82f6, #6366f1); }
.menu-icon.green { background: linear-gradient(135deg, #10b981, #22d3ee); }
.menu-icon.orange { background: linear-gradient(135deg, #f59e0b, #ef4444); }
.menu-icon.purple { background: linear-gradient(135deg, #a855f7, #ec4899); }

.menu-name {
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 4px;
}

.menu-desc {
  font-size: 11px;
  color: var(--fg-muted);
}

/* Form Elements */
.form-group {
  margin-bottom: 16px;
}

.form-label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--fg-secondary);
  margin-bottom: 8px;
}

.form-input {
  width: 100%;
  height: 48px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  padding: 0 16px;
  font-size: 16px;
  background: var(--bg);
  color: var(--fg);
  transition: var(--transition);
  font-family: inherit;
}

.form-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px var(--primary-glow);
}

.form-input, input, textarea {
  -webkit-user-select: text;
  -khtml-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}

.form-row {
  display: flex;
  gap: 12px;
}

.form-row .form-group {
  flex: 1;
}

/* Buttons */
.btn {
  width: 100%;
  height: 52px;
  border: none;
  border-radius: var(--radius-sm);
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: var(--transition);
  font-family: inherit;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  color: white;
  box-shadow: 0 4px 16px var(--primary-glow);
}

.btn-primary:active {
  transform: scale(0.98);
}

.btn-secondary {
  background: var(--bg-card);
  color: var(--fg);
  border: 1px solid var(--border);
}

/* Weight Buttons */
.weight-btns {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 8px;
}

.weight-btn {
  padding: 10px 16px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.weight-btn.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.weight-btn:active {
  transform: scale(0.95);
}

/* Result Box */
.result-box {
  background: linear-gradient(135deg, var(--bg-card) 0%, rgba(99, 102, 241, 0.1) 100%);
  border: 1px solid var(--primary);
  border-radius: var(--radius);
  padding: 24px;
  text-align: center;
}

.result-score {
  font-size: 48px;
  font-weight: 900;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.result-grade {
  font-size: 24px;
  font-weight: 800;
  margin-top: 8px;
}

.grade-A { color: var(--accent-green); }
.grade-B { color: #22d3ee; }
.grade-C { color: var(--accent-orange); }
.grade-D { color: #f97316; }
.grade-E { color: var(--accent-red); }

.result-info {
  margin-top: 16px;
  font-size: 14px;
  color: var(--fg-secondary);
  line-height: 1.8;
}

/* Meal Styles */
.date-tab {
  flex: 1;
  padding: 10px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg-secondary);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  text-align: center;
}

.date-tab.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

.meal-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}

.meal-tab {
  flex: 1;
  padding: 12px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg-secondary);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  text-align: center;
}

.meal-tab.active {
  background: var(--accent-green);
  color: white;
  border-color: var(--accent-green);
}

.meal-tab.breakfast.active {
  background: var(--accent-orange);
  border-color: var(--accent-orange);
}

.meal-tab.dinner.active {
  background: var(--accent-purple);
  border-color: var(--accent-purple);
}

.meal-content {
  background: var(--bg);
  border-radius: var(--radius-sm);
  padding: 20px;
  min-height: 150px;
}

.meal-item {
  padding: 10px 0;
  border-bottom: 1px dashed var(--border);
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.meal-item:last-child {
  border-bottom: none;
}

.meal-item::before {
  content: 'â€¢';
  color: var(--accent-green);
  font-weight: bold;
}

.meal-empty {
  text-align: center;
  color: var(--fg-muted);
  padding: 40px 20px;
}

.meal-school-info {
  background: var(--bg);
  border-radius: var(--radius-sm);
  padding: 12px 16px;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.meal-school-icon {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  background: linear-gradient(135deg, var(--accent-green), var(--secondary));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.meal-school-name {
  font-weight: 700;
  font-size: 15px;
}

.meal-school-date {
  font-size: 12px;
  color: var(--fg-muted);
  margin-top: 2px;
}

.meal-date-picker {
  margin-bottom: 12px;
}

.meal-vote-section {
  margin-top: 16px;
  padding: 16px;
  background: var(--bg);
  border-radius: var(--radius-sm);
}

.meal-vote-title {
  font-weight: 700;
  font-size: 14px;
  margin-bottom: 12px;
}

.meal-vote-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.meal-vote-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  background: var(--bg-card);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: var(--transition);
  border: 2px solid transparent;
}

.meal-vote-item:active {
  transform: scale(0.98);
}

.meal-vote-item.selected {
  border-color: var(--accent-green);
  background: rgba(16, 185, 129, 0.1);
}

.meal-vote-item input[type="radio"] {
  display: none;
}

.meal-vote-check {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  border: 2px solid var(--border-light);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  flex-shrink: 0;
}

.meal-vote-item.selected .meal-vote-check {
  background: var(--accent-green);
  border-color: var(--accent-green);
  color: white;
}

.meal-vote-name {
  flex: 1;
  font-size: 14px;
}

.meal-rank-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
}

.meal-rank-tab {
  flex: 1;
  padding: 8px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg-secondary);
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.meal-rank-tab.active {
  background: var(--accent-green);
  color: white;
  border-color: var(--accent-green);
}

.meal-rank-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.meal-rank-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: var(--bg);
  border-radius: var(--radius-sm);
}

.meal-rank-num {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent-orange), var(--accent-red));
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 12px;
  flex-shrink: 0;
}

.meal-rank-num.gold { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
.meal-rank-num.silver { background: linear-gradient(135deg, #9ca3af, #6b7280); }
.meal-rank-num.bronze { background: linear-gradient(135deg, #d97706, #92400e); }

.meal-rank-info {
  flex: 1;
}

.meal-rank-name {
  font-weight: 700;
  font-size: 14px;
}

.meal-rank-votes {
  font-size: 12px;
  color: var(--fg-muted);
}

/* Install Guide Styles */
.install-step {
  display: flex;
  gap: 16px;
  padding: 20px;
  background: var(--bg);
  border-radius: var(--radius-sm);
  margin-bottom: 12px;
}

.install-step-num {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 14px;
  flex-shrink: 0;
}

.install-step-content {
  flex: 1;
}

.install-step-title {
  font-weight: 700;
  font-size: 15px;
  margin-bottom: 4px;
}

.install-step-desc {
  font-size: 13px;
  color: var(--fg-secondary);
  line-height: 1.6;
}

.install-note {
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1));
  border: 1px solid var(--primary);
  border-radius: var(--radius-sm);
  padding: 16px;
  margin-top: 20px;
}

.install-note-title {
  font-weight: 700;
  font-size: 14px;
  color: var(--primary);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.install-note-desc {
  font-size: 13px;
  color: var(--fg-secondary);
  line-height: 1.6;
}

/* History Table */
.history-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

.history-table th {
  padding: 12px 8px;
  text-align: left;
  color: var(--fg-muted);
  font-weight: 600;
  border-bottom: 1px solid var(--border);
}

.history-table td {
  padding: 12px 8px;
  border-bottom: 1px solid var(--border);
}

.history-table tr:last-child td {
  border-bottom: none;
}

.delete-btn {
  color: var(--accent-red);
  cursor: pointer;
  font-weight: 600;
}

/* Subject Guide */
.subject-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px;
  background: var(--bg);
  border-radius: var(--radius-sm);
  margin-bottom: 8px;
  cursor: pointer;
  transition: var(--transition);
}

.subject-item:hover {
  background: var(--bg-card-hover);
}

.subject-item:active {
  transform: scale(0.98);
}

.subject-name {
  font-weight: 600;
  font-size: 15px;
}

.subject-weights {
  font-size: 12px;
  color: var(--fg-muted);
  margin-top: 4px;
}

.subject-arrow {
  color: var(--fg-muted);
  font-size: 18px;
}

/* Modal */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  display: none;
  justify-content: center;
  align-items: flex-end;
  z-index: 1000;
  padding: 20px;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: var(--bg-card);
  border-radius: var(--radius) var(--radius) 0 0;
  padding: 24px;
  width: 100%;
  max-width: 500px;
  max-height: 80vh;
  overflow-y: auto;
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from { transform: translateY(100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.modal-title {
  font-size: 18px;
  font-weight: 700;
}

.modal-close {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: none;
  background: var(--bg);
  color: var(--fg);
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Scroll Styling */
::-webkit-scrollbar {
  width: 4px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--border-light);
  border-radius: 4px;
}

/* Animation */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.animate-in {
  animation: fadeIn 0.4s ease forwards;
}

.delay-1 { animation-delay: 0.1s; opacity: 0; }
.delay-2 { animation-delay: 0.2s; opacity: 0; }
.delay-3 { animation-delay: 0.3s; opacity: 0; }
.delay-4 { animation-delay: 0.4s; opacity: 0; }

/* Bowling Styles */
.bowling-section {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.bowling-row {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.bowling-field {
  flex: 1;
  min-width: 100px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.bowling-label {
  font-size: 12px;
  color: var(--fg-secondary);
  font-weight: 600;
}

.bowling-names-section {
  margin-top: 12px;
}

.bowling-names-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 8px;
  margin-top: 8px;
}

.bowling-name-field select {
  width: 100%;
  padding: 10px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--fg);
  font-size: 14px;
}

.bowling-toolbar {
  display: flex;
  gap: 8px;
  margin-bottom: 12px;
}

.bowling-table-wrap {
  overflow-x: auto;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  margin-bottom: 12px;
}

.bowling-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

.bowling-table th,
.bowling-table td {
  padding: 10px 8px;
  text-align: center;
  border-bottom: 1px solid var(--border);
  white-space: nowrap;
}

.bowling-table th {
  background: var(--bg);
  color: var(--fg-secondary);
  font-weight: 600;
  font-size: 12px;
  position: sticky;
  top: 0;
}

.bowling-table td:first-child {
  text-align: left;
  font-weight: 700;
}

.bowling-table input {
  width: 60px;
  padding: 8px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: var(--bg);
  color: var(--fg);
  font-size: 14px;
  text-align: center;
}

.bowling-table .team-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 999px;
  font-size: 10px;
  font-weight: 700;
  margin-left: 6px;
}

.bowling-table .team-a {
  background: rgba(99, 102, 241, 0.2);
  color: #818cf8;
}

.bowling-table .team-b {
  background: rgba(239, 68, 68, 0.2);
  color: #f87171;
}

.bowling-table .row-win {
  background: rgba(16, 185, 129, 0.1);
}

.bowling-table .row-lose {
  background: rgba(239, 68, 68, 0.1);
}

.bowling-actions {
  display: flex;
  gap: 8px;
}

.bowling-result {
  margin-top: 16px;
  padding: 16px;
  background: var(--bg);
  border-radius: var(--radius-sm);
}

.bowling-result-title {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 12px;
}

.bowling-rank-list,
.bowling-settle-list,
.bowling-transfer-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.bowling-rank-item,
.bowling-settle-item,
.bowling-transfer-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  background: var(--bg-card);
  border-radius: var(--radius-sm);
}

.bowling-rank-num {
  width: 28px;
  height: 28px;
  border-radius: 8px;
  background: linear-gradient(135deg, var(--primary), var(--accent-purple));
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 12px;
  margin-right: 10px;
}

.bowling-rank-info {
  display: flex;
  align-items: center;
  flex: 1;
}

.bowling-rank-name {
  font-weight: 700;
}

.bowling-rank-score {
  font-size: 12px;
  color: var(--fg-muted);
}

.bowling-pill {
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 700;
}

.bowling-pill.good {
  background: rgba(16, 185, 129, 0.2);
  color: #10b981;
}

.bowling-pill.bad {
  background: rgba(239, 68, 68, 0.2);
  color: #ef4444;
}

.bowling-pill.info {
  background: rgba(99, 102, 241, 0.2);
  color: #818cf8;
}

.bowling-settle-info {
  font-size: 13px;
  color: var(--fg-secondary);
  margin-bottom: 10px;
}

.bowling-settle-name {
  font-weight: 700;
}

.bowling-settle-tag {
  font-size: 11px;
  color: var(--fg-muted);
}

.bowling-transfer-from {
  font-weight: 700;
}

.bowling-transfer-to {
  font-size: 12px;
  color: var(--fg-muted);
}

.bowling-team-col {
  padding: 12px;
  background: var(--bg);
  border-radius: var(--radius-sm);
}

/* More Page Styles */
.more-menu-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.more-menu-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px;
  background: var(--bg);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: var(--transition);
}

.more-menu-item:active {
  transform: scale(0.98);
  background: var(--bg-card-hover);
}

.more-menu-icon {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  flex-shrink: 0;
}

.more-menu-info {
  flex: 1;
}

.more-menu-name {
  font-weight: 700;
  font-size: 15px;
}

.more-menu-desc {
  font-size: 12px;
  color: var(--fg-muted);
  margin-top: 2px;
}

.more-menu-arrow {
  color: var(--fg-muted);
  font-size: 20px;
  font-weight: 300;
}

.more-info {
  text-align: center;
  padding: 20px;
}

.more-info-title {
  font-weight: 800;
  font-size: 18px;
  margin-bottom: 4px;
}

.more-info-desc {
  font-size: 13px;
  color: var(--fg-secondary);
}

.more-info-version {
  font-size: 12px;
  color: var(--fg-muted);
  margin-top: 8px;
}
</style>
</head>
<body data-theme="dark">

<div class="app-container">
  <!-- Header -->
  <header class="header">
    <div onclick="goToPage('home')" style="cursor: pointer;">
      <div class="header-title">ë©”ì¹´ 4ë°˜</div>
      <div class="header-subtitle">êµ­ë¦½êµ¬ë¯¸ì „ìê³µì—…ê³ ë“±í•™êµ</div>
    </div>
    <button class="theme-btn" id="themeBtn">ğŸŒ™</button>
  </header>

  <!-- Page Container -->
  <div class="page-container">
    
    <!-- Home Page -->
    <div class="page active" id="page-home">
      <div class="home-hero animate-in">
        <div class="home-logo">ë©”ì¹´</div>
        <div class="home-title">ë©”ì¹´ 4ë°˜</div>
        <div class="home-desc">ìš°ë¦¬ ë°˜ì„ ìœ„í•œ ì¢…í•© ë„ìš°ë¯¸</div>
      </div>

      <div class="menu-grid">
        <div class="menu-item animate-in delay-1" onclick="goToPage('install')">
          <div class="menu-icon blue">ğŸ“²</div>
          <div class="menu-name">ì•± ì„¤ì¹˜</div>
          <div class="menu-desc">í™ˆ í™”ë©´ì— ì¶”ê°€</div>
        </div>
        <div class="menu-item animate-in delay-2" onclick="goToPage('grade')">
          <div class="menu-icon purple">ğŸ“Š</div>
          <div class="menu-name">ì„±ì  ê³„ì‚°ê¸°</div>
          <div class="menu-desc">ë“±ê¸‰ ê³„ì‚°</div>
        </div>
        <div class="menu-item animate-in delay-3" onclick="goToPage('meal')">
          <div class="menu-icon green">ğŸ½ï¸</div>
          <div class="menu-name">ì˜¤ëŠ˜ì˜ ê¸‰ì‹</div>
          <div class="menu-desc">ê¸‰ì‹ ë©”ë‰´</div>
        </div>
        <div class="menu-item animate-in delay-4" onclick="goToPage('bowling')">
          <div class="menu-icon orange">ğŸ³</div>
          <div class="menu-name">ë³¼ë§ ì ìˆ˜íŒ</div>
          <div class="menu-desc">ë‚´ê¸° ì •ì‚°</div>
        </div>
      </div>
    </div>

    <!-- Install Guide Page -->
    <div class="page" id="page-install">
      <div class="card">
        <div class="card-title">
          <div class="card-title-icon" style="background: linear-gradient(135deg, #3b82f6, #6366f1);">ğŸ“²</div>
          ì•± ì„¤ì¹˜ ë°©ë²•
        </div>
        
        <div class="install-step">
          <div class="install-step-num">1</div>
          <div class="install-step-content">
            <div class="install-step-title">ê³µìœ  ë²„íŠ¼ ëˆ„ë¥´ê¸°</div>
            <div class="install-step-desc">Safari í•˜ë‹¨ì˜ ê³µìœ  ë²„íŠ¼(â–¡â†‘)ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”. AndroidëŠ” Chrome ë©”ë‰´(â‹®)ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
          </div>
        </div>

        <div class="install-step">
          <div class="install-step-num">2</div>
          <div class="install-step-content">
            <div class="install-step-title">í™ˆ í™”ë©´ì— ì¶”ê°€</div>
            <div class="install-step-desc">"í™ˆ í™”ë©´ì— ì¶”ê°€" ë˜ëŠ” "ì•± ì„¤ì¹˜" ë²„íŠ¼ì„ ì°¾ì•„ì„œ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
          </div>
        </div>

        <div class="install-step">
          <div class="install-step-num">3</div>
          <div class="install-step-content">
            <div class="install-step-title">ì¶”ê°€ ì™„ë£Œ</div>
            <div class="install-step-desc">"ì¶”ê°€" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í™ˆ í™”ë©´ì— ì•± ì•„ì´ì½˜ì´ ìƒì„±ë©ë‹ˆë‹¤!</div>
          </div>
        </div>

        <div class="install-note">
          <div class="install-note-title">ğŸ’¡ Tip</div>
          <div class="install-note-desc">
            í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ë©´ ì•±ì²˜ëŸ¼ ì „ì²´ í™”ë©´ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ë” ë¹ ë¥´ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆì–´ìš”!
          </div>
        </div>
      </div>
    </div>

    <!-- Grade Calculator Page -->
    <div class="page" id="page-grade">
      <div class="card">
        <div class="card-title">
          <div class="card-title-icon" style="background: linear-gradient(135deg, #a855f7, #ec4899);">ğŸ“Š</div>
          ì„±ì  ê³„ì‚°ê¸°
        </div>

        <div class="form-group">
          <label class="form-label">ê³¼ëª©ëª…</label>
          <input type="text" class="form-input" id="subjectName" placeholder="ì˜ˆ: ìë£Œêµ¬ì¡°">
        </div>

        <button class="btn btn-secondary" style="margin-bottom: 16px;" onclick="openSubjectModal()">
          ğŸ“‹ ê³¼ëª©ë³„ ë¹„ì¤‘ ë¶ˆëŸ¬ì˜¤ê¸°
        </button>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ìˆ˜í–‰í‰ê°€ ê°œìˆ˜</label>
            <input type="number" class="form-input" id="sCount" value="2" min="1" onchange="generateGradeInputs()">
          </div>
          <div class="form-group">
            <label class="form-label">ì§€í•„í‰ê°€ ê°œìˆ˜</label>
            <input type="number" class="form-input" id="tCount" value="2" min="1" max="2" onchange="generateGradeInputs()">
          </div>
        </div>
      </div>

      <div class="card" id="performanceBox"></div>
      <div class="card" id="examBox"></div>

      <button class="btn btn-primary" onclick="calculateGrade()">ê³„ì‚°í•˜ê¸°</button>

      <div class="card" id="gradeResult" style="display: none; margin-top: 16px;">
        <div class="result-box">
          <div class="result-score" id="resultScore">0</div>
          <div class="result-grade" id="resultGrade">-</div>
          <div class="result-info" id="resultInfo"></div>
        </div>
      </div>

      <div class="card" style="margin-top: 16px;">
        <div class="card-title" style="justify-content: space-between;">
          <span>ğŸ“ ê³„ì‚° ê¸°ë¡</span>
          <button class="delete-btn" onclick="clearHistory()">ì „ì²´ ì‚­ì œ</button>
        </div>
        <div style="overflow-x: auto;">
          <table class="history-table">
            <thead>
              <tr>
                <th>ê³¼ëª©</th>
                <th>ì ìˆ˜</th>
                <th>ë“±ê¸‰</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="historyBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Average Calculator Page -->
    <div class="page" id="page-average">
      <div class="card">
        <div class="card-title">
          <div class="card-title-icon" style="background: linear-gradient(135deg, #10b981, #22d3ee);">ğŸ“ˆ</div>
          í‰ê·  ê³„ì‚°ê¸°
        </div>

        <div class="form-group">
          <label class="form-label">ê³¼ëª© ê°œìˆ˜</label>
          <input type="number" class="form-input" id="avgSubjectCount" placeholder="ê³¼ëª© ê°œìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”" min="1" max="20">
        </div>

        <button class="btn btn-primary" onclick="generateAvgInputs()">ë‹¤ìŒ</button>
      </div>

      <div class="card" id="avgInputsCard" style="display: none;">
        <div class="card-title">ì ìˆ˜ ì…ë ¥</div>
        <div id="avgInputsContainer"></div>
        <button class="btn btn-primary" onclick="calculateAvg()">í‰ê·  ê³„ì‚°í•˜ê¸°</button>
      </div>

      <div class="card" id="avgResultCard" style="display: none;">
        <div class="result-box">
          <div style="font-size: 14px; color: var(--fg-secondary); margin-bottom: 8px;">ì „ì²´ í‰ê· </div>
          <div class="result-score" id="avgResultScore">0</div>
        </div>
        <button class="btn btn-secondary" style="margin-top: 16px;" onclick="resetAvg()">ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°</button>
      </div>
    </div>

    <!-- Meal Page -->
    <div class="page" id="page-meal">
      <div class="card">
        <div class="card-title">
          <div class="card-title-icon" style="background: linear-gradient(135deg, #f59e0b, #ef4444);">ğŸ½ï¸</div>
          ì˜¤ëŠ˜ì˜ ê¸‰ì‹
        </div>

        <div class="meal-school-info">
          <div class="meal-school-icon">ğŸ«</div>
          <div>
            <div class="meal-school-name">êµ­ë¦½êµ¬ë¯¸ì „ìê³µì—…ê³ ë“±í•™êµ</div>
            <div class="meal-school-date" id="mealDate" onclick="openDatePicker()" style="cursor: pointer; text-decoration: underline;">ë‚ ì§œ ì„ íƒ</div>
          </div>
        </div>

        <div class="meal-date-picker" id="mealDatePicker">
          <input type="date" id="mealDateInput" class="form-input" onchange="selectMealDate()">
        </div>

        <div class="meal-tabs" style="margin-bottom: 12px;">
          <button class="date-tab active" data-offset="0" onclick="changeDate(0)">ì˜¤ëŠ˜</button>
          <button class="date-tab" data-offset="1" onclick="changeDate(1)">ë‚´ì¼</button>
        </div>

        <div class="meal-tabs">
          <button class="meal-tab breakfast" onclick="changeMeal('breakfast')">ì¡°ì‹</button>
          <button class="meal-tab lunch active" onclick="changeMeal('lunch')">ì¤‘ì‹</button>
          <button class="meal-tab dinner" onclick="changeMeal('dinner')">ì„ì‹</button>
        </div>

        <div class="meal-content" id="mealContent">
          <div class="meal-empty">ê¸‰ì‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>

        <!-- ê¸‰ì‹ íˆ¬í‘œ -->
        <div class="meal-vote-section" id="mealVoteSection">
          <div class="meal-vote-title">â­ ì˜¤ëŠ˜ì˜ ë² ìŠ¤íŠ¸ ë©”ë‰´ íˆ¬í‘œ</div>
          <div class="meal-vote-list" id="mealVoteList"></div>
          <button class="btn small" onclick="submitMealVote()" id="mealVoteBtn" style="margin-top: 10px;">íˆ¬í‘œí•˜ê¸°</button>
        </div>
      </div>

      <!-- ê¸‰ì‹ ìˆœìœ„ -->
      <div class="card" style="margin-top: 12px;">
        <div class="card-title">
          <div class="card-title-icon" style="background: linear-gradient(135deg, #10b981, #22d3ee);">ğŸ†</div>
          ë² ìŠ¤íŠ¸ ê¸‰ì‹ ìˆœìœ„
        </div>
        <div class="meal-rank-tabs">
          <button class="meal-rank-tab active" onclick="showMealRank('breakfast')">ì¡°ì‹</button>
          <button class="meal-rank-tab" onclick="showMealRank('lunch')">ì¤‘ì‹</button>
          <button class="meal-rank-tab" onclick="showMealRank('dinner')">ì„ì‹</button>
        </div>
        <div id="mealRankList" class="meal-rank-list"></div>
      </div>
    </div>

    <!-- Bowling Page -->
    <div class="page" id="page-bowling">
      <div class="card">
        <div class="card-title">
          <div class="card-title-icon" style="background: linear-gradient(135deg, #ec4899, #8b5cf6);">ğŸ³</div>
          ë³¼ë§ ì ìˆ˜íŒ
        </div>

        <!-- ì„¤ì • ì„¹ì…˜ -->
        <div id="bowlingSetup">
          <div class="bowling-section">
            <div class="bowling-row">
              <div class="bowling-field">
                <label class="bowling-label">ëª¨ë“œ</label>
                <select id="bowlingMode" class="form-input">
                  <option value="solo">ê°œì¸ì „</option>
                  <option value="team">íŒ€ì „ (2íŒ€)</option>
                </select>
              </div>
              <div class="bowling-field">
                <label class="bowling-label">ì¸ì› ìˆ˜</label>
                <input type="number" id="bowlingPlayerCount" class="form-input" min="2" max="16" value="6">
              </div>
              <div class="bowling-field">
                <label class="bowling-label">ë¼ìš´ë“œ</label>
                <input type="number" id="bowlingRoundCount" class="form-input" min="1" max="10" value="3">
              </div>
            </div>

            <!-- ê°œì¸ì „ ì˜µì…˜ -->
            <div id="bowlingSoloOptions" class="bowling-row">
              <div class="bowling-field">
                <label class="bowling-label">í•˜ìœ„ ì¸ì› (ëˆ ë‚´ëŠ” ì‚¬ëŒ)</label>
                <input type="number" id="bowlingBottomPay" class="form-input" min="1" value="2">
              </div>
            </div>

            <!-- íŒ€ì „ ì˜µì…˜ -->
            <div id="bowlingTeamOptions" class="bowling-row hidden">
              <div class="bowling-field">
                <label class="bowling-label">1ì¸ë‹¹ ë²Œê¸ˆ</label>
                <input type="number" id="bowlingFine" class="form-input" min="0" step="1000" value="5000">
              </div>
              <div class="bowling-field">
                <label class="bowling-label">í•¸ë””ìº¡</label>
                <input type="number" id="bowlingHandicap" class="form-input" min="0" value="0">
              </div>
            </div>

            <!-- ì´ë¦„ ì„ íƒ (ê°œì¸ì „) -->
            <div id="bowlingSoloNames" class="bowling-names-section">
              <label class="bowling-label">í”Œë ˆì´ì–´ ì´ë¦„</label>
              <div id="bowlingNameFields" class="bowling-names-grid"></div>
            </div>

            <!-- ì´ë¦„ ì„ íƒ (íŒ€ì „) -->
            <div id="bowlingTeamNames" class="bowling-names-section hidden">
              <div class="bowling-team-col">
                <label class="bowling-label" style="color: #818cf8;">ğŸ”µ AíŒ€</label>
                <div id="bowlingTeamAFields" class="bowling-names-grid"></div>
              </div>
              <div class="bowling-team-col" style="margin-top: 12px;">
                <label class="bowling-label" style="color: #f87171;">ğŸ”´ BíŒ€</label>
                <div id="bowlingTeamBFields" class="bowling-names-grid"></div>
              </div>
            </div>

            <div class="bowling-row" style="margin-top: 16px;">
              <button class="btn primary" onclick="startBowlingGame()" style="flex: 1;">ê²Œì„ ì‹œì‘</button>
              <button class="btn" onclick="resetBowlingSetup()">ì´ˆê¸°í™”</button>
            </div>
          </div>
        </div>

        <!-- ê²Œì„ ì„¹ì…˜ -->
        <div id="bowlingGame" class="hidden">
          <div class="bowling-table-wrap">
            <table id="bowlingScoreTable" class="bowling-table"></table>
          </div>

          <div class="bowling-actions">
            <button class="btn" onclick="toggleBowlingResult()">ê²°ê³¼ ë³´ê¸°</button>
            <button class="btn" onclick="backToBowlingSetup()">ë‹¤ì‹œ ì„¤ì •</button>
          </div>

          <!-- ê²°ê³¼ ì„¹ì…˜ -->
          <div id="bowlingResult" class="bowling-result hidden">
            <div class="bowling-result-title">ğŸ† ê²°ê³¼</div>
            <div id="bowlingRankList" class="bowling-rank-list"></div>
            
            <div class="bowling-result-title" style="margin-top: 16px;">ğŸ’° ì •ì‚°</div>
            <div id="bowlingSettleInfo" class="bowling-settle-info"></div>
            <div id="bowlingSettleList" class="bowling-settle-list"></div>

            <div id="bowlingTransferSection" class="hidden">
              <div class="bowling-result-title" style="margin-top: 16px;">ğŸ“² ì´ì²´ ì•ˆë‚´</div>
              <div id="bowlingTransferList" class="bowling-transfer-list"></div>
            </div>

            <button class="btn small" onclick="toggleBowlingTransfer()" style="margin-top: 12px;">ì´ì²´ ì•ˆë‚´ ë³´ê¸°</button>
          </div>
        </div>
      </div>
    </div>

    <!-- More Page (ë”ë³´ê¸°) -->
    <div class="page" id="page-more">
      <div class="card">
        <div class="card-title">
          <div class="card-title-icon" style="background: linear-gradient(135deg, #6b7280, #374151);">â‹¯</div>
          ë”ë³´ê¸°
        </div>

        <div class="more-menu-list">
          <div class="more-menu-item" onclick="goToPage('average')">
            <div class="more-menu-icon" style="background: linear-gradient(135deg, #22d3ee, #6366f1);">ğŸ“ˆ</div>
            <div class="more-menu-info">
              <div class="more-menu-name">í‰ê·  ê³„ì‚°ê¸°</div>
              <div class="more-menu-desc">ì—¬ëŸ¬ ê³¼ëª©ì˜ í‰ê·  ì ìˆ˜ë¥¼ ê³„ì‚°í•´ìš”</div>
            </div>
            <div class="more-menu-arrow">â€º</div>
          </div>
          
          <div class="more-menu-item" onclick="goToPage('install')">
            <div class="more-menu-icon" style="background: linear-gradient(135deg, #6366f1, #a855f7);">ğŸ“²</div>
            <div class="more-menu-info">
              <div class="more-menu-name">ì•± ì„¤ì¹˜ ê°€ì´ë“œ</div>
              <div class="more-menu-desc">í™ˆ í™”ë©´ì— ì•±ì²˜ëŸ¼ ì¶”ê°€í•˜ê¸°</div>
            </div>
            <div class="more-menu-arrow">â€º</div>
          </div>

          <div class="more-menu-item" onclick="location.href='admin.html'">
            <div class="more-menu-icon" style="background: linear-gradient(135deg, #ef4444, #f59e0b);">ğŸ”</div>
            <div class="more-menu-info">
              <div class="more-menu-name">ê´€ë¦¬ì í˜ì´ì§€</div>
              <div class="more-menu-desc">ë°ì´í„° í™•ì¸ ë° ê´€ë¦¬</div>
            </div>
            <div class="more-menu-arrow">â€º</div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top: 12px;">
        <div class="more-info">
          <div class="more-info-title">ë©”ì¹´ 4ë°˜ ì•±</div>
          <div class="more-info-desc">êµ­ë¦½êµ¬ë¯¸ì „ìê³µì—…ê³ ë“±í•™êµ ë©”ì¹´íŠ¸ë¡œë‹‰ìŠ¤ê³¼ 4ë°˜</div>
          <div class="more-info-version">Version 1.0</div>
        </div>
      </div>
    </div>

  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <button class="nav-item active" onclick="goToPage('home')">
      <span class="nav-icon">ğŸ </span>
      <span class="nav-label">í™ˆ</span>
    </button>
    <button class="nav-item" onclick="goToPage('grade')">
      <span class="nav-icon">ğŸ“Š</span>
      <span class="nav-label">ì„±ì </span>
    </button>
    <button class="nav-item" onclick="goToPage('meal')">
      <span class="nav-icon">ğŸ½ï¸</span>
      <span class="nav-label">ê¸‰ì‹</span>
    </button>
    <button class="nav-item" onclick="goToPage('bowling')">
      <span class="nav-icon">ğŸ³</span>
      <span class="nav-label">ë³¼ë§</span>
    </button>
    <button class="nav-item" onclick="goToPage('more')">
      <span class="nav-icon">â‹¯</span>
      <span class="nav-label">ë”ë³´ê¸°</span>
    </button>
  </nav>
</div>

<!-- Subject Modal -->
<div class="modal" id="subjectModal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">ê³¼ëª©ë³„ ë¹„ì¤‘</div>
      <button class="modal-close" onclick="closeSubjectModal()">Ã—</button>
    </div>
    <div id="subjectList"></div>
  </div>
</div>

<script>
// ë”ë¸”íƒ­ í™•ëŒ€ ë°©ì§€
let lastTouchEnd = 0;
document.addEventListener('touchend', function(event) {
  const now = (new Date()).getTime();
  if (now - lastTouchEnd <= 300) {
    event.preventDefault();
  }
  lastTouchEnd = now;
}, false);

// í•€ì¹˜ ì¤Œ ë°©ì§€
document.addEventListener('touchmove', function(event) {
  if (event.touches.length > 1) {
    event.preventDefault();
  }
}, { passive: false });

// ì œìŠ¤ì²˜ ì´ë²¤íŠ¸ ë°©ì§€ (Safari)
document.addEventListener('gesturestart', function(event) {
  event.preventDefault();
});
document.addEventListener('gesturechange', function(event) {
  event.preventDefault();
});
document.addEventListener('gestureend', function(event) {
  event.preventDefault();
});

// ========== 12ì›” ê¸‰ì‹ ë°ì´í„° (ìˆ˜ë™) ==========
const MEAL_DATABASE = {
  '20251212': {
    breakfast: ['í°ë°¥', 'ì‡ ê³ ê¸°ë‘ë¶€êµ­', 'ì•¼ì±„ê³„ë€ì°œ', 'ì¹¼ì§‘ë¹„ì—”ë‚˜ì¼€ì°¹ë³¶ìŒ', 'ë‹­ë‹¤ë¦¬ì‚´ìŠ¤í…Œì´í¬', 'ë°°ì¶”ê¹€ì¹˜', 'ë‘¥ì‹¤ì°¹ìŒ€ë–¡', 'ë¸ëª¬íŠ¸ì¥¬ìŠ¤'],
    lunch: ['ì°¨ìˆ˜ìˆ˜ë°¥', 'ë‹¬ì½¤ë‹¨í˜¸ë°•ì£½', 'ì˜›ë‚ ì°°ìˆœëŒ€êµ­', 'ë¹…í˜íŒŒë¡ í­ë¦½', 'ì‹œê¸ˆì¹˜ë¬´ì¹¨', 'ë°°ì¶”ê¹€ì¹˜', 'í´ë˜ì‹ê°¸ë˜ì‡¼ì½œë¼', 'í˜¼í•©ìŒë£Œ'],
    dinner: null
  },
  '20251213': { breakfast: null, lunch: null, dinner: null }, // í† ìš”ì¼
  '20251214': { breakfast: null, lunch: null, dinner: null }, // ì¼ìš”ì¼
  '20251215': {
    breakfast: ['í°ë°¥', 'ì‡ ê³ ê¸°ë¯¸ì—­êµ­', 'ì¶˜ì²œë‹­ê°ˆë¹„', 'ì•¼ì±„ê³„ë€ë§ì´', 'ë°°ì¶”ê¹€ì¹˜', 'ì´ˆì½”ì¸„ì´ìŠ¤ë§ë„ë„›', 'ì•¼ì¿ ë¥´íŠ¸/í‚¤ì§±'],
    lunch: ['ë…¸ë‘ì°¨ì¡°ë°¥', 'ë¼ì§€ë“±ë¼ˆê°ìíƒ•', 'ë¸Œë¡œì½œë¦¬ì´ˆíšŒ', 'í›ˆì œì˜¤ë¦¬ìˆ™ì£¼ë³¶ìŒ', 'í¬ëŸ¼ë¸”í¬ëŸ°ì¹˜í‚¨', 'ë°°ì¶”ê¹€ì¹˜', 'ì´ˆì½”íë‹¹ë°”ë‚˜ë‚˜ë¹µ', 'ì¹œí™˜ê²½ë©œë¡ ', 'ì•¼ì¿ ë¥´íŠ¸ì œë¡œ'],
    dinner: ['í˜¼í•©ì¡ê³¡ë°¥', 'ê°ìê³ ì¶”ì¥ì°Œê°œ', 'ì½©ë‚˜ë¬¼ë§¤ì½¤ë¬´ì¹¨', 'ì˜¤ì‚¼ë¶ˆê³ ê¸°', 'í†µì‚´ì§€íŒŒì´', 'ë°°ì¶”ê¹€ì¹˜', 'êµ¬ë¦„í¬ë ˆì»¤', 'ì¥¬ì‹œì¿¨']
  },
  '20251216': {
    breakfast: ['í°ë°¥', 'ì‡ ê³ ê¸°ë¯¸ì—­êµ­', 'ì¶˜ì²œë‹­ê°ˆë¹„', 'ì•¼ì±„ê³„ë€ë§ì´', 'ë°°ì¶”ê¹€ì¹˜', 'ì´ˆì½”ì¸„ì´ìŠ¤ë§ë„ë„›', 'ì•¼ì¿ ë¥´íŠ¸/í‚¤ì§±'],
    lunch: ['í˜¼í•©ì¡ê³¡ë°¥', 'ëª¨ë“¬ì–´ë¬µêµ­', 'ìˆ¯ë¶ˆì–‘ë…ìª¼ë¦¼ë‹­', 'ì–‘ë…ê¹»ì', 'ì«„ë©´ì•¼ì±„ë¬´ì¹¨', 'ë°°ì¶”ê¹€ì¹˜', 'ë¶•ì–´ë¹µ/íŒ¥', 'ë„ë„›ì•„ì´ìŠ¤í¬ë¦¼'],
    dinner: ['í°ë°¥', 'ê¹€ì¹˜ìˆœë‘ë¶€ì°Œê°œ', 'ë„í† ë¦¬ë¬µ/ì–‘ë…ì¥', 'ë¶ˆë‹­ì´ì•¼í•¨ë°•ì´ì•¼', 'ìŠ¤íŒ¸êµ¬ì´/ì¼€ì°¹', 'ë°°ì¶”ê¹€ì¹˜', 'í”¼í¬ë‹‰']
  },
  '20251217': {
    breakfast: ['ê¹€ì¹˜ì¹˜ì¦ˆêµ¬ìš´ì£¼ë¨¹ë°¥', 'ì‡ ê³ ê¸°ì•¼ì±„ì£½', 'ì‚¼ìƒ‰ì†Œì‹œì§€ìƒˆì†¡ì´ë³¶ìŒ', 'ë°°ì¶”ê¹€ì¹˜', 'ì‹œë¦¬ì–¼/ìš°ìœ (ì´ˆì½”ì²µìŠ¤)', 'êµ¬ìŠ¬ë–¡'],
    lunch: ['í˜¼í•©ì¡ê³¡ë°¥', 'ì²­ì–‘ê³ ì¶”ëœì¥ì°Œê°œ', 'ë¹„ë²•ì¥ëŒ€íŒŒì¡±ë°œ', 'ëª¨ë“¬ì•¼ì±„ì˜¤ë¦¬ì—”íƒˆì†ŒìŠ¤ìƒëŸ¬ë“œ', 'ê³„ë€ì…íŒì—ê·¸ë‘ë•¡', 'ë°°ì¶”ê¹€ì¹˜', 'í™”ê³¼ë°©ìš°ë¦¬ìŒ€ì‚¬ê³¼ë§Œì£¼', 'ì œì£¼ìƒ˜ë¬¼ëª©ì¥ìš”ê±°íŠ¸'],
    dinner: ['ë¶ˆê³ ê¸°ê¹€ì¹˜ë¼ì´ìŠ¤ë²„ê±°', 'ìœ ë¶€ìš°ë™êµ­', 'í˜¼í•©ë©¸ì¹˜ë³¶ìŒ', 'ë°°ì¶”ê¹€ì¹˜', 'ì•™ë²„í„°ì ˆí¸', 'ë¸ëª¬íŠ¸ì¥¬ìŠ¤']
  },
  '20251218': {
    breakfast: ['í°ë°¥', 'ë°°ì¶”ëœì¥êµ­', 'ìš°ì‚¼ê²¹ìˆ™ì£¼ë³¶ìŒ', 'ë‚¨í•´ë§ˆëŠ˜í•˜íŠ¸ë¯¸ë‹ˆí•¨ë°•', 'í†µì‚´ê°€ë“ìˆœì‚´ì¹˜í‚¨', 'ë°°ì¶”ê¹€ì¹˜', 'ìš°ìœ ë¡¤ì¼€ì´í¬', 'ì•¼ì¿ ë¥´íŠ¸/ì—”ìš”í”Œë ˆì¸'],
    lunch: ['ì••ë§¥ë°¥', 'í•œìš°ë‚˜ì£¼ê³°íƒ•', 'íƒ•í‰ì±„', 'ì±„ì–´ë¬µë³¶ìŒ', 'ë‚¨ë„ë–¡ê°ˆë¹„êµ¬ì´', 'ì„ë°•ì§€', 'ì™€ê·œë¶ˆê³ ê¸°í”¼ì', 'ì¹œí™˜ê²½ê°ê·¤', 'ì•„ì¹¨ì—ì¥¬ìŠ¤'],
    dinner: ['í˜¼í•©ì¡ê³¡ë°¥', 'ê·¼ëŒ€ëœì¥êµ­', 'ì•¼ì±„ê³„ë€ì°œ', 'ì™•ëˆê¹ŒìŠ¤&ì†ŒìŠ¤', 'ë”ë¸”í†µí†µìƒˆìš°ê¼¬ì¹˜', 'ë°°ì¶”ê¹€ì¹˜', 'ì•¼ì¿ ë¥´íŠ¸ì œë¡œ', 'ìš°ìœ í¬ë¦¼íŒì½˜']
  },
  '20251219': {
    breakfast: ['í°ë°¥', 'ê°ììˆ˜ì œë¹„êµ­', 'ë‹­ê³ ê¸°ë‹¨í˜¸ë°•ì¡°ë¦¼', 'ëª…ì—½ì±„ë³¶ìŒ', 'ìŠ¤íŒ¸êµ¬ì´/ì¼€ì°¹', 'ë°°ì¶”ê¹€ì¹˜', 'ê³ ê¸°ì¡ì±„ì°ë¹µ', 'ë°”ë‚˜ë‚˜ë¼ë–¼'],
    lunch: ['ì°¨ìˆ˜ìˆ˜ë°¥', 'ì œì£¼í‘ë¼ì§€ë¬µì€ì§€ê¹€ì¹˜ì°Œê°œ', 'íŒŒê¹€ì¹˜', 'ì¹˜ì»¤ë¦¬ë¶€ì¶”ìƒì±„', 'í•´ë¬¼ë³¶ìŒìš°ë™', 'ì •í†µí™ì¶˜ì²œë‹­ê°ˆë¹„', 'í´ë˜ì‹ê°¸ë˜ì‡¼ì½œë¼', 'í˜¼í•©ìŒë£Œ'],
    dinner: ['í°ë°¥', 'ìœ¡ê°œì¥', 'ë™ì¸ë™ì°œê°ˆë¹„', 'ì˜¤ì´ì–‘íŒŒë¬´ì¹¨', 'ì˜¤ì§•ì–´ê¹€ì¹˜ì „', 'ë°°ì¶”ê¹€ì¹˜', 'ë˜í‚¨ë„ë„›/ë¯¸ë‹ˆí•‘í¬í•˜íŠ¸', 'ì•¼ì¿ ë¥´íŠ¸']
  },
  '20251220': {
    breakfast: ['í–„ê¹€ì¹˜ë³¶ìŒë°¥', 'ë¬´ë‘ë¶€íƒ•êµ­', 'êµìë§Œë‘íŠ€ê¹€', 'ë„ˆë¹„ì•„ë‹ˆêµ¬ì´', 'ë°°ì¶”ê¹€ì¹˜', 'ë ˆëª¬ì¼€ì´í¬', 'ì´ˆì½”ìš°ìœ '],
    lunch: ['í°ë°¥', 'í˜¸ë°•ëœì¥ì°Œê°œ', 'ì½©ë‚˜ë¬¼ë¬´ì¹¨', 'ì œìœ¡ë³¶ìŒ', 'ìœ¡ì›ì „', 'ë°°ì¶”ê¹€ì¹˜', 'í¬ë¦¼ì¹´ìŠ¤í…Œë¼ë¨¸í•€', 'ê³¼ì¼ì¥¬ìŠ¤(ì¿¨í”¼ìŠ¤)', 'ì¹œí™˜ê²½ë”¸ê¸°'],
    dinner: ['ì§œì¥ë°¥', 'ê³„ë€ì‹¤íŒŒêµ­', 'ë‘ë¶€êµ¬ì´ì–‘ë…ì¡°ë¦¼', 'ì½°ì‚­ë¹ ì‚­ìˆœì‚´ì¹˜í‚¨', 'ë°°ì¶”ê¹€ì¹˜', 'ìŠ¤ì½œ/ì‚¬ê³¼ë§›']
  },
  '20251221': {
    breakfast: ['í°ë°¥', 'ì‡ ê³ ê¸°ë‹¹ë©´êµ­', 'ë§¤ì½¤ì–´ë¬µë³¶ìŒ', 'ì˜¤ì‚¼ë¶ˆê³ ê¸°', 'ë©”ë°€ê¹€ì¹˜ì „ë³‘', 'ë°°ì¶”ê¹€ì¹˜', 'ì•½ê³¼ë„ë„›', 'ìŠ¤ì½œ/ì‚¬ê³¼ë§›'],
    lunch: ['í°ë°¥', 'ì°¸ì¹˜ê¹€ì¹˜ì°Œê°œ', 'ì¹´ë ˆì†ŒìŠ¤', 'ìˆ¯ë¶ˆì–‘ë…ìª¼ë¦¼ë‹­', 'êµìë§Œë‘íŠ€ê¹€', 'ë°°ì¶”ê¹€ì¹˜', 'ë‘¥ì‹¤ì°¹ìŒ€ë–¡', 'ì•¼ì¿ ë¥´íŠ¸'],
    dinner: ['í–„ì•¼ì±„ë³¶ìŒë°¥', 'ë§‘ì€ë¯¸ì—­êµ­', 'ìƒì¶”ì¹˜ì»¤ë¦¬ë¬´ì¹¨', 'ë„ì‹œë½ê¹€', 'ë°”ë² íì¹˜í‚¨ê¼¬ì¹˜', 'ë°°ì¶”ê¹€ì¹˜', 'ì´ˆì½”ì¸„ì´ìŠ¤ë§ë„ë„›', 'ê³¼ì¼ì¥¬ìŠ¤(ì¿¨í”¼ìŠ¤)']
  },
  '20251222': {
    breakfast: ['í°ë°¥', 'ë–¡êµ­', 'ë¼ì§€ê°ˆë¹„ì°œ', 'ì—°ë‘ë¶€/ì–‘ë…ì¥', 'ìˆ™ì£¼ë§›ì‚´ë¬´ì¹¨', 'ë°°ì¶”ê¹€ì¹˜', 'ìš°ë¦¬ë°€í†µíŒ¥ì¹¼ìŠ˜ì°ë¹µ', 'ë¬´ê°€ë‹¹ì•¼ì¿ ë¥´íŠ¸'],
    lunch: ['ê°•í™©ìŒ€ë°¥', 'ìƒˆì•ŒíŒ¥ì£½', 'ì²­ì–‘ê³ ì¶”ëœì¥ì°Œê°œ', 'ë¯¸ì—­ì¤„ê¸°ë³¶ìŒ', 'ê°€ìë¯¸íŠ€ê¹€ì–‘ë…', 'LAë¼ì§€ê°ˆë¹„êµ¬ì´', 'ë°°ì¶”ê¹€ì¹˜', 'ì•™ë²„í„°ì ˆí¸', 'ìœ ê¸°ë†ì•¼ì±„ì‚¬ë‘í‚¤ì¦ˆ'],
    dinner: ['í˜¼í•©ì¡ê³¡ë°¥', 'ìœ¡ê°œì¥', 'ì§€ë¦¬ë©¸ì¹˜ì½©ê°•ì •ë³¶ìŒ', 'ë–¡ë³¶ì´/ê¹€ë§ì´', 'ë‚¨ë„ë–¡ê°ˆë¹„êµ¬ì´', 'ë°°ì¶”ê¹€ì¹˜', 'íƒ€ì½”ì•¼ë¼ë³¼ ê¼¬ì¹˜', 'í”¼í¬ë‹‰']
  },
  '20251223': {
    breakfast: ['í°ë°¥', 'ëª¨ë“¬ì–´ë¬µêµ­', 'ê½ˆë¦¬ê³ ì¶”ë©”ì¶”ë¦¬ì•Œì¥ì¡°ë¦¼', 'ê°ìë² ì´ì»¨ë³¶ìŒ', 'ì œì£¼í‘ë¼ì§€ë¶ˆê³ ê¸°', 'ë°°ì¶”ê¹€ì¹˜', 'ë¹„í”¼ë”ìŠ¤', 'ë‹¤í¬ì´ˆì½”ë„›ì¸ '],
    lunch: ['ì½©ë‚˜ë¬¼ë°¥/ì–‘ë…ì¥', 'ì”ì¹˜êµ­ìˆ˜', 'ì¹˜í‚¨ìŠ¤í…Œì´í¬', 'ë°°ì¶”ê¹€ì¹˜', 'ë¬´ë§ë­ì´ê¹€ì¹˜', 'ì—ê·¸íƒ€ë¥´íŠ¸', 'ë¯¸ë‹ˆë©œì¸ êµ¬ìŠ¬ì•„ì´ìŠ¤í¬ë¦¼', 'ì¹œí™˜ê²½í¬ë„(ìƒ¤ì¸ë¨¸ìŠ¤ì¼“)'],
    dinner: ['ì˜¤ë¦¬í›ˆì œì†Œì´í•„ë¼í”„', 'ì‡ ê³ ê¸°ë‘ë¶€íƒ•êµ­', 'ê¾¼ì¥í¬ì±„ë³¶ìŒ', 'ì¹˜í‚¨í…ë”/ì†ŒìŠ¤', 'ë°°ì¶”ê¹€ì¹˜', 'ìš”ê±°íŠ¸', 'ë¸”ë™í¬ë¡œì¹¸ìŠˆ']
  },
  '20251224': {
    breakfast: ['í°ë°¥', 'ì‡ ê³ ê¸°ë‘ë¶€êµ­', 'ì•¼ì±„ê³„ë€ì°œ', 'íŒŒë˜ìë°˜ë³¶ìŒ', 'í›ˆì œì˜¤ë¦¬ê°ìë³¶ìŒ', 'ë°°ì¶”ê¹€ì¹˜', 'ìš”ê±°ì–Œì–Œìš”êµ¬ë¥´íŠ¸', 'ìš°ë¦¬ì°¹ìŒ€íŒ¥ê½ˆë°°ê¸°ë„ë„›'],
    lunch: ['í˜¼í•©ì¡ê³¡ë°¥', 'ì‡ ê³ ê¸°ë¯¸ì—­êµ­', 'ë‘ë¶€êµ¬ì´ì–‘ë…ì¡°ë¦¼', 'ëª¨ë“¬ì•¼ì±„ì˜¤ë¦¬ì—”íƒˆì†ŒìŠ¤ìƒëŸ¬ë“œ', 'ì–‘ë…ê¹»ì', 'ì˜¤ë¸ì§í™”í•œë§ˆë¦¬í†µë‹­', 'ë°°ì¶”ê¹€ì¹˜', 'ë¸Œë¼ìš°ë‹ˆì¼€ìµ', 'ë°€í‚¤ì†Œë‹¤'],
    dinner: ['í°ë°¥', 'ë‘ë¶€ê°ìê³ ì¶”ì¥ì°Œê°œ', 'ì˜¤ì§•ì–´ì‹¤ì±„ë¬´ì¹¨', 'í•´ë¬¼ë³¶ìŒìš°ë™', 'ì„êº½ì •ë–¡ê°ˆë¹„', 'ë°°ì¶”ê¹€ì¹˜', 'í¬ë¦¼í’ˆì€ë°”ì›€ì¿ í—¨', 'ê³¼ì±„ì•¼ì±„í•©ì²´']
  },
  '20251225': {
    breakfast: ['íŒŒê¸°ë¦„ë¶ˆê³ ê¸°ì£¼ë¨¹ë°¥', 'ì˜ì–‘ë‹­ì£½', 'í”¼ë§ë–¡ê°ˆë¹„ì¡°ë¦¼', 'ë°°ì¶”ê¹€ì¹˜', 'ì‹œë¦¬ì–¼/ìš°ìœ (ì˜¤ë ˆì˜¤ì˜¤ì¦ˆ)', 'ë ˆëª¬ì¼€ì´í¬'],
    lunch: ['ë…¸ë‘ì°¨ì¡°ë°¥', 'ìŠ¤íŒ¸ë¶€ëŒ€ì°Œê°œ', 'ì—°ê·¼ì¡°ë¦¼', 'í—ˆë¸Œì†”íŠ¸ëª¨ë“¬êµ¬ì´', 'ë°°ì¶”ê¹€ì¹˜', 'ê³ ê¸°ì¡ì±„ì°ë¹µ', 'ìƒì¶”ìŒˆ&ìŒˆì¥', 'ìš°ìœ í¬ë¦¼íŒì½˜', 'ì¥¬ì‹œì¿¨'],
    dinner: ['í˜¼í•©ì¡ê³¡ë°¥', 'ë§Œë‘êµ­', 'ê°ìë² ì´ì»¨ì¡°ë¦¼', 'ë™ì¸ë™ë‹­ê°ˆë¹„', 'ë„ˆë¹„ì•„ë‹ˆêµ¬ì´', 'ë°°ì¶”ê¹€ì¹˜', 'ë©”ì´í”Œí”¼ì¹¸íŒŒì´', 'ì˜¤ë¼ë–¼ìº”']
  },
  '20251226': {
    breakfast: ['í°ë°¥', 'ì‡ ê³ ê¸°êµ­', 'ë¼ìš´ë“œí–„ì¡°ë¦¼', 'ì•ˆë™ì°œë‹­(í† ë§‰)', 'ì˜¤ì´ì–‘íŒŒë¬´ì¹¨', 'ë°°ì¶”ê¹€ì¹˜', 'ìš°ë¦¬ë°€ì´ˆì½”íŒŒì´', 'í”¼í¬ë‹‰'],
    lunch: ['ì••ë§¥ë°¥', 'ë¼ì§€ë“±ë¼ˆê°ìíƒ•', 'ì‹œê¸ˆì¹˜ì¡ì±„', 'ì²­ì–‘ê³ ì¶”ì†¡ì†¡ë–¡ê°ˆë¹„', 'ë°°ì¶”ê¹€ì¹˜', 'ë¶ˆë‹­ë³¶ìŒê¼¬ê¼¬ì¹˜í‚¨', 'ì´ˆì½”íë‹¹ë°”ë‚˜ë‚˜ë¹µ', 'ì¹œí™˜ê²½ë©œë¡ ', 'í˜¼í•©ìŒë£Œ'],
    dinner: ['í°ë°¥', 'ì–¼í°ì§¬ë½•ë¼ë©´', 'ë§ˆëŠ˜ì«‘ì§„ë¯¸ì±„ë¬´ì¹¨', 'í•œì…ë‹¨ë¬´ì§€ë¬´ì¹¨', 'ë°°ì¶”ê¹€ì¹˜', 'ìš”ê±°í†¡ì´ˆì½”ë³¼&í¬ëŸ°ì¹˜', 'ë°”ì‚­ì–‘ë…ë‹­ê°•ì •']
  },
  '20251227': {
    breakfast: ['í°ë°¥', 'ìˆœë‘ë¶€ì°Œê°œ', 'ìˆ™ì£¼ë‚˜ë¬¼ë¬´ì¹¨', 'ë¶ˆí–¥ê³ ì¶”ì¥ë¶ˆê³ ê¸°', 'í†µì‚´ì§€íŒŒì´', 'ë°°ì¶”ê¹€ì¹˜', 'í¬ë¦¼íŠ¸ìœ„ìŠ¤íŠ¸ê½ˆë°°ê¸°', 'ê³¼ì¼ì¥¬ìŠ¤'],
    lunch: ['í’ìë„¤ë¶ˆë‹­ë§ˆìš”ë®ë°¥', 'ê³„ë€ì‹¤íŒŒêµ­', 'ë“±ì‹¬ëˆê¹ŒìŠ¤&ì†ŒìŠ¤', 'ë¶ˆë‹­ì¹˜ì¦ˆê³ ë¡œì¼€', 'ë°°ì¶”ê¹€ì¹˜', 'ì–‘ë°°ì¶”ì½˜ìƒëŸ¬ë“œ', 'ì•¼ì¿ ë¥´íŠ¸/í‚¤ì§±'],
    dinner: ['ë§ˆíŒŒë‘ë¶€ë®ë°¥', 'í˜¸ë°•ëœì¥ì°Œê°œ', 'ì§€ì½”ë°”ìˆ¯ë¶ˆë°”ë² í', 'ë°°ì¶”ê¹€ì¹˜', 'ë¶ˆê³ ê¸°í¬ì¼“ë¸Œë ˆë“œ', 'ë¬´ê°€ë‹¹ì•¼ì¿ ë¥´íŠ¸']
  },
  '20251228': {
    breakfast: ['í•˜ì´ë¼ì´ìŠ¤', 'ìœ ë¶€ê³„ë€êµ­', 'ìš°ì‚¼ê²¹ìˆ™ì£¼ë³¶ìŒ', 'ë‚¨í•´ë§ˆëŠ˜í•˜íŠ¸ë¯¸ë‹ˆí•¨ë°•', 'ë°°ì¶”ê¹€ì¹˜', 'êµ¬ìŠ¬ë–¡', 'í—ˆë‹ˆë”ë¸”(ìš”êµ¬ë¥´íŠ¸)'],
    lunch: ['í°ë°¥', 'ì‡ ê³ ê¸°íƒ•êµ­', 'ì˜¤ì´ìŠ¤í‹±ë¬´ì¹¨', 'ì¶”ì–µì˜ê²½ì–‘ì‹ëˆê¹ŒìŠ¤', 'ë‚¨í•´ë§ˆëŠ˜í•˜íŠ¸ë¯¸ë‹ˆí•¨ë°•', 'ë°°ì¶”ê¹€ì¹˜', 'í¬ë¦¼ì¹´ìŠ¤í…Œë¼ë¨¸í•€', 'ê³¼ì¼ì¥¬ìŠ¤(ì¿¨í”¼ìŠ¤)'],
    dinner: ['ë°ë¦¬ì•¼ë¼ì¹˜í‚¨ë®ë°¥', 'ë§‘ì€ì½©ë‚˜ë¬¼êµ­', 'ë“±ì‹¬í‘ì„ìíƒ•ìˆ˜ìœ¡', 'ë©”ë°€ê¹€ì¹˜ì „ë³‘', 'ë°°ì¶”ê¹€ì¹˜', 'í¬ë¦¼íŠ¸ìœ„ìŠ¤íŠ¸ê½ˆë°°ê¸°', 'ì¥¬ì‹œì¿¨']
  },
  '20251229': {
    breakfast: ['í°ë°¥', 'ë°°ì¶”ëœì¥êµ­', 'ë‹­ê³ ê¸°ë‹¨í˜¸ë°•ì¡°ë¦¼', 'ëª…ì—½ì±„ë³¶ìŒ', 'ë°°ì¶”ê¹€ì¹˜', 'ìš°ë¦¬ì°¹ìŒ€íŒ¥ê½ˆë°°ê¸°ë„ë„›', 'ì·¨ì˜ë£¨ê³ ê¸°ì°ë§Œë‘', 'ì´ˆì½”ìš°ìœ '],
    lunch: ['ì°°ê¸°ì¥ë°¥', 'ì²­êµ­ì¥ì°Œê°œ', 'ë¹„ë¹”êµ­ìˆ˜/ì˜¥ìˆ˜ìˆ˜ë©´', 'ë¶ì„±ë¡œì—°íƒ„ë¶ˆê³ ê¸°/ë§¤ì½¤', 'ë‚¨ë„ë–¡ê°ˆë¹„êµ¬ì´', 'ë°°ì¶”ê¹€ì¹˜', 'í”¼í¬ë‹‰', 'í™”ê³¼ë°©ìš°ë¦¬ìŒ€ì‚¬ê³¼ë§Œì£¼'],
    dinner: ['í°ë°¥', 'ëˆìœ¡ê¹€ì¹˜ì°Œê°œ', 'ì•¼ì±„ê³„ë€ë§ì´', 'ë„ì‹œë½ê¹€', 'ì–¸ì–‘ì‹ë¶ˆê³ ê¸°/íŒŒì ˆì´', 'ë°°ì¶”ê¹€ì¹˜', 'ìš°ë¦¬ìŒ€ë¶ˆë‹­ê³ êµ¬ë§ˆí”¼ì', 'ì•¼ì¿ ë¥´íŠ¸/í‚¤ì§±']
  },
  '20251230': {
    breakfast: ['í°ë°¥', 'ë‘ë¶€ê°ìê³ ì¶”ì¥ì°Œê°œ', 'íŒŒë˜ìë°˜ë³¶ìŒ', 'ë§›ìµ¸í‚¹ê¹í’ê¸°', 'ì˜¥ìˆ˜ìˆ˜ì•¼í•¨ë°•ì´ì•¼', 'ë°°ì¶”ê¹€ì¹˜', 'ì´ˆì½”ì¹©íŠ¸ìœ„ìŠ¤íŠ¸ì¿ í‚¤', 'ì•„ì˜¬ë‹¤ë¶€ìŠ¤í„°'],
    lunch: ['í˜¼í•©ì¡ê³¡ë°¥', 'ì˜›ë‚ ì°°ìˆœëŒ€êµ­', 'ì˜¤ì§•ì–´ë¬´ì¹¨íšŒ', 'ì–‘ë…ê¹»ì', 'í¬ëŸ¼ë¸”í¬ëŸ°ì¹˜í‚¨', 'ë°°ì¶”ê¹€ì¹˜', 'ë¶•ì–´ë¹µ/ìŠˆí¬ë¦¼', 'ì•¼ì¿ ë¥´íŠ¸ì œë¡œ', 'ì¹œí™˜ê²½ë”¸ê¸°'],
    dinner: ['í°ë°¥', 'ë§‘ì€ê°ìêµ­', 'ì‚¼ìƒ‰ì†Œì‹œì§€ë¸Œë¡œì½œë¦¬ë³¶ìŒ', 'ëŒ€íŒ¨ë¶ˆê³ ê¸°', 'ìŠ¤íŠ¸ë§ì¹˜ì¦ˆì–´ë¬µë°”', 'ë°°ì¶”ê¹€ì¹˜', 'ê³ ê¸°ì°ë§Œë‘', 'ì˜¤ë¼ë–¼ìº”']
  },
  '20251231': {
    breakfast: ['ì°¸ì¹˜ë§ˆìš”êµ¬ìš´ì£¼ë¨¹ë°¥', 'ì‡ ê³ ê¸°ì•¼ì±„ì£½', 'ì¹˜ì¦ˆë² ì´ì»¨ê°ìê³ ë¡œì¼€', 'ë°°ì¶”ê¹€ì¹˜', 'ì‹œë¦¬ì–¼/ìš°ìœ (ì•„ëª¬ë“œ,ì½”ì½”ë³¼)'],
    lunch: ['ì°°í˜„ë¯¸ë°¥', 'íŒ½ì´ë²„ì„¯ëœì¥êµ­', 'ìˆ™ì„±ë¬µì€ì§€ì°œë‹­', 'ì‹œê¸ˆì¹˜ë¬´ì¹¨', 'íŒŒê¹€ì¹˜', 'í•œì…ë•¡ì´ˆë¶€ì¶”ì „', 'í†µì‚´ìƒˆìš°ê¹ŒìŠ¤', 'ìŠ¤íŒŒí´ë§ë“œë§í¬', 'ìš°ìœ ìƒí¬ë¦¼ì½”ë¥´ë„¤íŒŒì´'],
    dinner: null
  }
};

let currentMealType = 'lunch';
let currentDateOffset = 0; // 0: ì˜¤ëŠ˜, 1: ë‚´ì¼
let mealData = { breakfast: null, lunch: null, dinner: null };

// ========== í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜ ==========
function goToPage(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  
  document.getElementById('page-' + pageId).classList.add('active');
  
  const navMap = { home: 0, grade: 1, average: 4, meal: 2, bowling: 3, more: 4, install: 0 };
  document.querySelectorAll('.nav-item')[navMap[pageId]].classList.add('active');
  
  if (pageId === 'meal') {
    loadMealData();
  }
}

// ========== í…Œë§ˆ ì „í™˜ ==========
const themeBtn = document.getElementById('themeBtn');
function applyTheme(theme) {
  document.body.dataset.theme = theme;
  localStorage.setItem('theme', theme);
  themeBtn.textContent = theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
}

applyTheme(localStorage.getItem('theme') || 'dark');
themeBtn.onclick = () => applyTheme(document.body.dataset.theme === 'dark' ? 'light' : 'dark');

// ========== ê¸‰ì‹ ê´€ë ¨ ==========
function getDateWithOffset(offset) {
  const date = new Date();
  date.setDate(date.getDate() + offset);
  return date;
}

function formatDateForAPI(date) {
  return `${date.getFullYear()}${String(date.getMonth() + 1).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}`;
}

function formatDisplayDate(date) {
  if (!date) date = new Date();
  const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
  return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')} (${days[date.getDay()]})`;
}

// ë‚ ì§œ ë³€ê²½ (ì˜¤ëŠ˜/ë‚´ì¼)
function changeDate(offset) {
  currentDateOffset = offset;
  document.querySelectorAll('.date-tab').forEach(tab => tab.classList.remove('active'));
  document.querySelector(`.date-tab[data-offset="${offset}"]`).classList.add('active');
  loadMealData();
}

function loadMealData() {
  const targetDate = getDateWithOffset(currentDateOffset);
  document.getElementById('mealDate').textContent = formatDisplayDate(targetDate);
  const mealContent = document.getElementById('mealContent');

  // ì£¼ë§ ì²´í¬
  const dayOfWeek = targetDate.getDay();
  if (dayOfWeek === 0 || dayOfWeek === 6) {
    mealContent.innerHTML = '<div class="meal-empty">ğŸ  ì£¼ë§ì—ëŠ” ê¸‰ì‹ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    document.getElementById('mealVoteSection').style.display = 'none';
    return;
  }

  const dateStr = formatDateForAPI(targetDate);
  
  // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê¸‰ì‹ ì •ë³´ ì¡°íšŒ
  if (MEAL_DATABASE[dateStr]) {
    const dbData = MEAL_DATABASE[dateStr];
    mealData = {
      breakfast: dbData.breakfast || null,
      lunch: dbData.lunch || null,
      dinner: dbData.dinner || null
    };
    displayMeal(currentMealType);
    document.getElementById('mealVoteSection').style.display = 'block';
    renderMealVoteList();
  } else {
    mealContent.innerHTML = `
      <div class="meal-empty">
        ğŸ“­ ê¸‰ì‹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤<br>
        <small style="color: var(--fg-muted);">í•´ë‹¹ ë‚ ì§œì˜ ê¸‰ì‹ ë°ì´í„°ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ì–´ìš”</small>
      </div>
    `;
    document.getElementById('mealVoteSection').style.display = 'none';
  }
}

function displayMeal(type) {
  const mealContent = document.getElementById('mealContent');
  const menu = mealData[type];

  if (!menu || menu.length === 0) {
    mealContent.innerHTML = '<div class="meal-empty">ê¸‰ì‹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }

  let html = '';
  menu.forEach(item => {
    if (item) {
      html += `<div class="meal-item">${item}</div>`;
    }
  });
  mealContent.innerHTML = html;
}

function changeMeal(type) {
  currentMealType = type;
  document.querySelectorAll('.meal-tab').forEach(tab => tab.classList.remove('active'));
  document.querySelector(`.meal-tab.${type}`).classList.add('active');
  displayMeal(type);
  renderMealVoteList();
}

// ë‚ ì§œ ì„ íƒê¸°
function openDatePicker() {
  const picker = document.getElementById('mealDatePicker');
  const input = document.getElementById('mealDateInput');
  
  // í˜„ì¬ ë‚ ì§œë¡œ ì„¤ì •
  const today = new Date();
  input.value = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
  input.showPicker && input.showPicker();
}

function selectMealDate() {
  const input = document.getElementById('mealDateInput');
  const selected = new Date(input.value);
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  // ì˜¤ëŠ˜ê³¼ì˜ ì°¨ì´ ê³„ì‚°
  const diff = Math.floor((selected - today) / (1000 * 60 * 60 * 24));
  currentDateOffset = diff;
  
  // íƒ­ í™œì„±í™” ì—…ë°ì´íŠ¸
  document.querySelectorAll('.date-tab').forEach(tab => tab.classList.remove('active'));
  if (diff === 0) {
    document.querySelector('.date-tab[data-offset="0"]').classList.add('active');
  } else if (diff === 1) {
    document.querySelector('.date-tab[data-offset="1"]').classList.add('active');
  }
  
  loadMealData();
}

// ê¸‰ì‹ íˆ¬í‘œ ì‹œìŠ¤í…œ
let mealVotes = JSON.parse(localStorage.getItem('mealVotes') || '{}');
let currentMealVote = null;

function renderMealVoteList() {
  const voteList = document.getElementById('mealVoteList');
  const menu = mealData[currentMealType];
  
  if (!menu || menu.length === 0) {
    voteList.innerHTML = '<div style="color: var(--fg-muted); font-size: 13px;">íˆ¬í‘œí•  ë©”ë‰´ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
    document.getElementById('mealVoteBtn').style.display = 'none';
    return;
  }
  
  document.getElementById('mealVoteBtn').style.display = 'block';
  currentMealVote = null;
  
  voteList.innerHTML = menu.map((item, idx) => `
    <div class="meal-vote-item" onclick="selectMealVote(${idx})">
      <div class="meal-vote-check">âœ“</div>
      <div class="meal-vote-name">${item}</div>
    </div>
  `).join('');
}

function selectMealVote(idx) {
  currentMealVote = idx;
  document.querySelectorAll('.meal-vote-item').forEach((item, i) => {
    item.classList.toggle('selected', i === idx);
  });
}

function submitMealVote() {
  if (currentMealVote === null) {
    alert('ë©”ë‰´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
    return;
  }
  
  const menu = mealData[currentMealType];
  const selectedMenu = menu[currentMealVote];
  const voteKey = `${currentMealType}_${selectedMenu}`;
  
  // íˆ¬í‘œ ì €ì¥
  if (!mealVotes[voteKey]) {
    mealVotes[voteKey] = { name: selectedMenu, type: currentMealType, count: 0 };
  }
  mealVotes[voteKey].count++;
  
  localStorage.setItem('mealVotes', JSON.stringify(mealVotes));
  
  alert(`"${selectedMenu}"ì— íˆ¬í‘œí–ˆìŠµë‹ˆë‹¤! ğŸ‰`);
  currentMealVote = null;
  document.querySelectorAll('.meal-vote-item').forEach(item => item.classList.remove('selected'));
  
  showMealRank(currentMealType);
}

let currentRankType = 'lunch';

function showMealRank(type) {
  currentRankType = type;
  document.querySelectorAll('.meal-rank-tab').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.meal-rank-tab').forEach(tab => {
    if (tab.textContent.includes(type === 'breakfast' ? 'ì¡°ì‹' : type === 'lunch' ? 'ì¤‘ì‹' : 'ì„ì‹')) {
      tab.classList.add('active');
    }
  });
  
  const rankList = document.getElementById('mealRankList');
  
  // í•´ë‹¹ íƒ€ì…ì˜ íˆ¬í‘œë§Œ í•„í„°ë§
  const filtered = Object.values(mealVotes)
    .filter(v => v.type === type)
    .sort((a, b) => b.count - a.count)
    .slice(0, 10);
  
  if (filtered.length === 0) {
    rankList.innerHTML = '<div style="color: var(--fg-muted); padding: 20px; text-align: center;">ì•„ì§ íˆ¬í‘œê°€ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }
  
  rankList.innerHTML = filtered.map((item, idx) => `
    <div class="meal-rank-item">
      <div class="meal-rank-num ${idx === 0 ? 'gold' : idx === 1 ? 'silver' : idx === 2 ? 'bronze' : ''}">${idx + 1}</div>
      <div class="meal-rank-info">
        <div class="meal-rank-name">${idx === 0 ? 'ğŸ† ' : ''}${item.name}</div>
        <div class="meal-rank-votes">${item.count}í‘œ</div>
      </div>
    </div>
  `).join('');
}

// ========== ì„±ì  ê³„ì‚°ê¸° ==========
const defaultSubjects = [
  { name: 'ìë£Œêµ¬ì¡°', sCount: 2, tCount: 2, sWeights: [30, 30], tWeights: [20, 20] },
  { name: 'ì˜ì–´', sCount: 2, tCount: 1, sWeights: [20, 30], tWeights: [50] },
  { name: 'ê¸°ê³„', sCount: 2, tCount: 2, sWeights: [30, 30], tWeights: [20, 20] },
  { name: 'ìë™í™”ì„¤ë¹„', sCount: 2, tCount: 2, sWeights: [30, 30], tWeights: [20, 20] },
  { name: 'ì „ìíšŒë¡œ', sCount: 2, tCount: 2, sWeights: [30, 30], tWeights: [20, 20] },
  { name: 'ì „ê¸°íšŒë¡œ', sCount: 2, tCount: 2, sWeights: [25, 25], tWeights: [20, 30] },
  { name: 'êµ­ì–´', sCount: 2, tCount: 1, sWeights: [20, 30], tWeights: [50] },
  { name: 'ê³µí†µì‚¬íšŒ1', sCount: 2, tCount: 1, sWeights: [30, 30], tWeights: [40] }
];

function loadSubjects() {
  const saved = localStorage.getItem('customSubjects');
  return saved ? JSON.parse(saved) : [...defaultSubjects];
}

function openSubjectModal() {
  const subjects = loadSubjects();
  const list = document.getElementById('subjectList');
  
  list.innerHTML = subjects.map((subj, idx) => {
    const sText = subj.sWeights.map((w, i) => `ìˆ˜í–‰${i + 1} ${w}%`).join(', ');
    const tText = subj.tCount === 1 ? `ê¸°ë§ ${subj.tWeights[0]}%` : `ì¤‘ê°„ ${subj.tWeights[0]}%, ê¸°ë§ ${subj.tWeights[1]}%`;
    
    return `
      <div class="subject-item" onclick="applySubject(${idx})">
        <div>
          <div class="subject-name">${subj.name}</div>
          <div class="subject-weights">${sText} / ${tText}</div>
        </div>
        <span class="subject-arrow">â€º</span>
      </div>
    `;
  }).join('');

  document.getElementById('subjectModal').classList.add('active');
}

function closeSubjectModal() {
  document.getElementById('subjectModal').classList.remove('active');
}

function applySubject(idx) {
  const subjects = loadSubjects();
  const subj = subjects[idx];
  
  document.getElementById('subjectName').value = subj.name;
  document.getElementById('sCount').value = subj.sCount;
  document.getElementById('tCount').value = subj.tCount;
  
  generateGradeInputs();
  
  setTimeout(() => {
    for (let i = 0; i < subj.sCount; i++) {
      const weightInput = document.getElementById(`sw${i}`);
      if (weightInput) {
        weightInput.value = subj.sWeights[i];
        updateWeightBtns(`sw${i}`, subj.sWeights[i]);
      }
    }
    for (let i = 0; i < subj.tCount; i++) {
      const weightInput = document.getElementById(`tw${i}`);
      if (weightInput) {
        weightInput.value = subj.tWeights[i];
        updateWeightBtns(`tw${i}`, subj.tWeights[i]);
      }
    }
  }, 100);
  
  closeSubjectModal();
}

function updateWeightBtns(id, value) {
  const btns = document.querySelectorAll(`[data-weight-id="${id}"]`);
  btns.forEach(btn => {
    btn.classList.toggle('active', parseInt(btn.dataset.value) === value);
  });
}

function selectWeight(id, value, btn) {
  document.getElementById(id).value = value;
  document.querySelectorAll(`[data-weight-id="${id}"]`).forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
}

function generateGradeInputs() {
  const sCount = parseInt(document.getElementById('sCount').value);
  const tCount = parseInt(document.getElementById('tCount').value);

  const weights = [20, 25, 30, 40, 50];

  let sHTML = '<div class="card-title" style="font-size: 16px;">ìˆ˜í–‰í‰ê°€</div>';
  for (let i = 0; i < sCount; i++) {
    sHTML += `
      <div class="form-group">
        <label class="form-label">ìˆ˜í–‰ ${i + 1} ì ìˆ˜</label>
        <input type="number" class="form-input" id="s${i}" placeholder="ì ìˆ˜ ì…ë ¥">
      </div>
      <div class="form-group">
        <label class="form-label">ë¹„ì¤‘</label>
        <input type="hidden" id="sw${i}">
        <div class="weight-btns">
          ${weights.map(w => `<button type="button" class="weight-btn" data-weight-id="sw${i}" data-value="${w}" onclick="selectWeight('sw${i}', ${w}, this)">${w}%</button>`).join('')}
        </div>
      </div>
    `;
  }
  document.getElementById('performanceBox').innerHTML = sHTML;

  let tHTML = '<div class="card-title" style="font-size: 16px;">ì§€í•„í‰ê°€</div>';
  for (let i = 0; i < tCount; i++) {
    const label = tCount === 1 ? 'ê¸°ë§ê³ ì‚¬' : (i === 0 ? 'ì¤‘ê°„ê³ ì‚¬' : 'ê¸°ë§ê³ ì‚¬');
    tHTML += `
      <div class="form-group">
        <label class="form-label">${label} ì ìˆ˜</label>
        <input type="number" class="form-input" id="t${i}" placeholder="ì ìˆ˜ ì…ë ¥">
      </div>
      <div class="form-group">
        <label class="form-label">ë¹„ì¤‘</label>
        <input type="hidden" id="tw${i}">
        <div class="weight-btns">
          ${weights.map(w => `<button type="button" class="weight-btn" data-weight-id="tw${i}" data-value="${w}" onclick="selectWeight('tw${i}', ${w}, this)">${w}%</button>`).join('')}
        </div>
      </div>
    `;
  }
  document.getElementById('examBox').innerHTML = tHTML;
}

function calculateGrade() {
  const sCount = parseInt(document.getElementById('sCount').value);
  const tCount = parseInt(document.getElementById('tCount').value);
  const subjectName = document.getElementById('subjectName').value.trim() || '-';

  let total = 0;
  let weightSum = 0;
  let finalWeight = 0;
  let finalScore = 0;

  for (let i = 0; i < sCount; i++) {
    const score = parseFloat(document.getElementById(`s${i}`).value) || 0;
    const weight = parseFloat(document.getElementById(`sw${i}`).value) || 0;
    total += score * (weight / 100);
    weightSum += weight;
  }

  for (let i = 0; i < tCount; i++) {
    const score = parseFloat(document.getElementById(`t${i}`).value) || 0;
    const weight = parseFloat(document.getElementById(`tw${i}`).value) || 0;
    if (tCount === 1 || i === tCount - 1) {
      finalWeight = weight / 100;
      finalScore = score;
    }
    total += score * (weight / 100);
    weightSum += weight;
  }

  if (weightSum !== 100) {
    alert(`ì´ ë¹„ì¤‘ì´ 100%ê°€ ì•„ë‹™ë‹ˆë‹¤. (í˜„ì¬: ${weightSum}%)`);
    return;
  }

  total = parseFloat(total.toFixed(2));
  const grade = total >= 90 ? 'A' : total >= 80 ? 'B' : total >= 70 ? 'C' : total >= 60 ? 'D' : 'E';
  
  const nextCut = { A: null, B: 90, C: 80, D: 70, E: 60 }[grade];
  const currCut = { A: 90, B: 80, C: 70, D: 60, E: 0 }[grade];

  let nextMsg = 'ìµœê³  ë“±ê¸‰!';
  if (total === 100) {
    nextMsg = 'ë§Œì !';
  } else if (nextCut) {
    const need = (nextCut - (total - finalScore * finalWeight)) / finalWeight;
    nextMsg = need > 100 ? 'ë¶ˆê°€ëŠ¥' : `ê¸°ë§ ${need.toFixed(1)}ì  í•„ìš”`;
  }

  const drop = (currCut - 0.01 - (total - finalScore * finalWeight)) / finalWeight;
  const dropMsg = drop < 0 ? 'ë–¨ì–´ì§ˆ ë“±ê¸‰ ì—†ìŒ' : `ê¸°ë§ ${drop.toFixed(1)}ì  ì´í•˜ì‹œ í•˜ë½`;

  document.getElementById('resultScore').textContent = total;
  document.getElementById('resultGrade').textContent = grade + 'ë“±ê¸‰';
  document.getElementById('resultGrade').className = 'result-grade grade-' + grade;
  document.getElementById('resultInfo').innerHTML = `
    ì˜¬ë¼ê°ˆ ê¸°ì¤€: ${nextMsg}<br>
    ë–¨ì–´ì§ˆ ê¸°ì¤€: ${dropMsg}
  `;
  document.getElementById('gradeResult').style.display = 'block';

  saveHistory({ subject: subjectName, score: total, grade });
  renderHistory();
}

function loadHistory() {
  return JSON.parse(localStorage.getItem('gradeHistory') || '[]');
}

function saveHistory(entry) {
  const history = loadHistory();
  entry.date = new Date().toLocaleDateString('ko-KR');
  history.unshift(entry);
  localStorage.setItem('gradeHistory', JSON.stringify(history.slice(0, 20)));
}

function clearHistory() {
  if (confirm('ê¸°ë¡ì„ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    localStorage.removeItem('gradeHistory');
    renderHistory();
  }
}

function deleteHistoryItem(idx) {
  const history = loadHistory();
  history.splice(idx, 1);
  localStorage.setItem('gradeHistory', JSON.stringify(history));
  renderHistory();
}

function renderHistory() {
  const tbody = document.getElementById('historyBody');
  const history = loadHistory();
  
  if (history.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--fg-muted);">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
    return;
  }

  tbody.innerHTML = history.map((h, i) => `
    <tr>
      <td>${h.subject}</td>
      <td>${h.score}</td>
      <td class="grade-${h.grade}">${h.grade}</td>
      <td><span class="delete-btn" onclick="deleteHistoryItem(${i})">ì‚­ì œ</span></td>
    </tr>
  `).join('');
}

// ========== í‰ê·  ê³„ì‚°ê¸° ==========
function generateAvgInputs() {
  const count = parseInt(document.getElementById('avgSubjectCount').value);
  
  if (!count || count < 1 || count > 20) {
    alert('1~20 ì‚¬ì´ì˜ ê³¼ëª© ê°œìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }

  let html = '';
  for (let i = 0; i < count; i++) {
    html += `
      <div class="form-group">
        <label class="form-label">ê³¼ëª© ${i + 1} ì ìˆ˜</label>
        <input type="number" class="form-input" id="avgScore${i}" placeholder="ì ìˆ˜ ì…ë ¥" min="0" max="100">
      </div>
    `;
  }

  document.getElementById('avgInputsContainer').innerHTML = html;
  document.getElementById('avgInputsCard').style.display = 'block';
  document.getElementById('avgResultCard').style.display = 'none';
  
  setTimeout(() => document.getElementById('avgScore0').focus(), 100);
}

function calculateAvg() {
  const count = parseInt(document.getElementById('avgSubjectCount').value);
  let total = 0;
  let validCount = 0;

  for (let i = 0; i < count; i++) {
    const score = parseFloat(document.getElementById(`avgScore${i}`).value);
    if (!isNaN(score) && score >= 0) {
      total += score;
      validCount++;
    }
  }

  if (validCount === 0) {
    alert('ìµœì†Œ 1ê°œ ì´ìƒì˜ ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }

  const average = (total / validCount).toFixed(2);
  document.getElementById('avgResultScore').textContent = average;
  document.getElementById('avgInputsCard').style.display = 'none';
  document.getElementById('avgResultCard').style.display = 'block';
}

function resetAvg() {
  document.getElementById('avgSubjectCount').value = '';
  document.getElementById('avgInputsCard').style.display = 'none';
  document.getElementById('avgResultCard').style.display = 'none';
}

// ========== ì´ˆê¸°í™” ==========
window.addEventListener('load', () => {
  generateGradeInputs();
  renderHistory();
  const today = getDateWithOffset(0);
  document.getElementById('mealDate').textContent = formatDisplayDate(today);
  
  // ê¸‰ì‹ íˆ¬í‘œ ì´ˆê¸°í™”
  setTimeout(() => {
    renderMealVoteList();
    showMealRank('lunch');
  }, 100);
});

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
document.getElementById('subjectModal').addEventListener('click', (e) => {
  if (e.target.id === 'subjectModal') closeSubjectModal();
});

// ========== ë³¼ë§ ì ìˆ˜íŒ ==========
const BOWLING_PRESET_NAMES = ["ê¹€ë¬´ì„±","ê¹€ìŠ¹ì¤€","ë°•ì‹ í›„","ë°•ì§€ì™„","ì†ê´‘ë•","ì€ëŒ€ê·œ","ì´ì›ì§„","ì¡°ì„¸ê¸°","ìµœë¯¼ì¬","ìµœìš°ì˜","ìµœì§€í˜¸"];
const BOWLING_WINNER_BONUS = 5000;

const bowlingState = {
  mode: 'solo',
  playerCount: 6,
  roundCount: 3,
  bottomPayCount: 2,
  teamFine: 5000,
  handicap: 0,
  names: [],
  scores: [],
  teams: { A: [], B: [] }
};

function initBowlingNames() {
  bowlingState.names = Array.from({ length: bowlingState.playerCount }, (_, i) => `í”Œë ˆì´ì–´ ${i + 1}`);
}

function initBowlingScores() {
  bowlingState.scores = Array.from({ length: bowlingState.playerCount }, () => 
    Array.from({ length: bowlingState.roundCount }, () => null)
  );
}

function createBowlingNameSelect(idx, label) {
  const div = document.createElement('div');
  div.className = 'bowling-name-field';
  
  const select = document.createElement('select');
  select.innerHTML = `<option value="">${label}</option>` + 
    BOWLING_PRESET_NAMES.map((n, i) => `<option value="${i}">${n}</option>`).join('') +
    `<option value="custom">âœï¸ ì§ì ‘ ì…ë ¥</option>`;
  
  select.addEventListener('change', () => {
    if (select.value === 'custom') {
      const customName = prompt('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
      if (customName && customName.trim()) {
        bowlingState.names[idx] = customName.trim();
        // ì»¤ìŠ¤í…€ ì´ë¦„ì„ ì˜µì…˜ì— ì¶”ê°€
        const newOption = document.createElement('option');
        newOption.value = `custom_${idx}`;
        newOption.textContent = customName.trim();
        newOption.selected = true;
        select.insertBefore(newOption, select.querySelector('option[value="custom"]'));
      } else {
        select.value = '';
        bowlingState.names[idx] = `í”Œë ˆì´ì–´ ${idx + 1}`;
      }
    } else if (select.value === '') {
      bowlingState.names[idx] = `í”Œë ˆì´ì–´ ${idx + 1}`;
    } else if (select.value.startsWith('custom_')) {
      // ì´ë¯¸ ì»¤ìŠ¤í…€ ì´ë¦„ ì„ íƒëœ ê²½ìš°
    } else {
      bowlingState.names[idx] = BOWLING_PRESET_NAMES[+select.value];
    }
  });
  
  div.appendChild(select);
  return div;
}

function renderBowlingNameFields() {
  const soloContainer = document.getElementById('bowlingNameFields');
  const teamAContainer = document.getElementById('bowlingTeamAFields');
  const teamBContainer = document.getElementById('bowlingTeamBFields');
  
  soloContainer.innerHTML = '';
  teamAContainer.innerHTML = '';
  teamBContainer.innerHTML = '';
  
  if (bowlingState.mode === 'team') {
    // íŒ€ì „: AíŒ€, BíŒ€ ë”°ë¡œ
    const aCount = Math.ceil(bowlingState.playerCount / 2);
    const bCount = Math.floor(bowlingState.playerCount / 2);
    
    for (let i = 0; i < aCount; i++) {
      teamAContainer.appendChild(createBowlingNameSelect(i, `A${i + 1}`));
    }
    for (let j = 0; j < bCount; j++) {
      teamBContainer.appendChild(createBowlingNameSelect(aCount + j, `B${j + 1}`));
    }
    
    bowlingState.teams.A = [...Array(aCount).keys()];
    bowlingState.teams.B = [...Array(bCount).keys()].map(x => aCount + x);
    
    document.getElementById('bowlingSoloNames').classList.add('hidden');
    document.getElementById('bowlingTeamNames').classList.remove('hidden');
  } else {
    // ê°œì¸ì „
    for (let i = 0; i < bowlingState.playerCount; i++) {
      soloContainer.appendChild(createBowlingNameSelect(i, `ì´ë¦„ ${i + 1}`));
    }
    
    document.getElementById('bowlingSoloNames').classList.remove('hidden');
    document.getElementById('bowlingTeamNames').classList.add('hidden');
  }
}

// ëª¨ë“œ ë³€ê²½
document.getElementById('bowlingMode').addEventListener('change', (e) => {
  bowlingState.mode = e.target.value;
  document.getElementById('bowlingSoloOptions').classList.toggle('hidden', bowlingState.mode === 'team');
  document.getElementById('bowlingTeamOptions').classList.toggle('hidden', bowlingState.mode !== 'team');
  
  initBowlingNames();
  renderBowlingNameFields();
});

// ì¸ì› ë³€ê²½
document.getElementById('bowlingPlayerCount').addEventListener('input', (e) => {
  bowlingState.playerCount = Math.max(2, Math.min(16, +e.target.value));
  initBowlingNames();
  renderBowlingNameFields();
});

function resetBowlingSetup() {
  document.getElementById('bowlingMode').value = 'solo';
  document.getElementById('bowlingPlayerCount').value = 6;
  document.getElementById('bowlingRoundCount').value = 3;
  document.getElementById('bowlingBottomPay').value = 2;
  document.getElementById('bowlingFine').value = 5000;
  document.getElementById('bowlingHandicap').value = 0;
  
  bowlingState.mode = 'solo';
  bowlingState.playerCount = 6;
  bowlingState.roundCount = 3;
  bowlingState.bottomPayCount = 2;
  bowlingState.teamFine = 5000;
  bowlingState.handicap = 0;
  
  document.getElementById('bowlingSoloOptions').classList.remove('hidden');
  document.getElementById('bowlingTeamOptions').classList.add('hidden');
  
  initBowlingNames();
  renderBowlingNameFields();
}

function startBowlingGame() {
  bowlingState.mode = document.getElementById('bowlingMode').value;
  bowlingState.playerCount = Math.max(2, Math.min(16, +document.getElementById('bowlingPlayerCount').value));
  bowlingState.roundCount = Math.max(1, Math.min(10, +document.getElementById('bowlingRoundCount').value));
  bowlingState.bottomPayCount = Math.max(1, +document.getElementById('bowlingBottomPay').value);
  bowlingState.teamFine = Math.max(0, +document.getElementById('bowlingFine').value);
  bowlingState.handicap = Math.max(0, +document.getElementById('bowlingHandicap').value);
  
  // íŒ€ ì„¤ì •
  const half = Math.ceil(bowlingState.playerCount / 2);
  bowlingState.teams.A = [...Array(half).keys()];
  bowlingState.teams.B = [...Array(bowlingState.playerCount - half).keys()].map(x => half + x);
  
  initBowlingScores();
  renderBowlingTable();
  
  document.getElementById('bowlingSetup').classList.add('hidden');
  document.getElementById('bowlingGame').classList.remove('hidden');
  document.getElementById('bowlingResult').classList.add('hidden');
}

function backToBowlingSetup() {
  document.getElementById('bowlingSetup').classList.remove('hidden');
  document.getElementById('bowlingGame').classList.add('hidden');
}

function resetBowlingScores() {
  initBowlingScores();
  renderBowlingTable();
  document.getElementById('bowlingResult').classList.add('hidden');
}

function bowlingSumRow(idx) {
  const arr = bowlingState.scores[idx].filter(v => v !== null);
  return arr.length === 0 ? NaN : arr.reduce((a, b) => a + b, 0);
}

function bowlingAvgRow(idx) {
  const arr = bowlingState.scores[idx].filter(v => v !== null);
  return arr.length === 0 ? NaN : arr.reduce((a, b) => a + b, 0) / arr.length;
}

function bowlingTeamSum(teamIdxs) {
  const sums = teamIdxs.map(idx => bowlingSumRow(idx)).filter(v => !isNaN(v));
  return sums.length ? sums.reduce((a, b) => a + b, 0) : NaN;
}

function renderBowlingTable() {
  const table = document.getElementById('bowlingScoreTable');
  
  let thead = `<thead><tr><th style="text-align:left">ì´ë¦„</th>`;
  for (let i = 0; i < bowlingState.roundCount; i++) {
    thead += `<th>R${i + 1}</th>`;
  }
  thead += `<th>í•©ê³„</th><th>í‰ê· </th></tr></thead>`;
  
  let tbody = '<tbody>';
  bowlingState.names.forEach((name, r) => {
    const sum = bowlingSumRow(r);
    const avg = bowlingAvgRow(r);
    
    let teamBadge = '';
    let rowClass = '';
    
    // íŒ€ì „ì¼ ë•Œë§Œ íŒ€ ë±ƒì§€ì™€ ìƒ‰ìƒ í‘œì‹œ
    if (bowlingState.mode === 'team') {
      if (bowlingState.teams.A.includes(r)) {
        teamBadge = '<span class="team-badge team-a">A</span>';
      } else {
        teamBadge = '<span class="team-badge team-b">B</span>';
      }
      
      const aSum = bowlingTeamSum(bowlingState.teams.A);
      const bSum = bowlingTeamSum(bowlingState.teams.B);
      const aAdj = bowlingState.teams.A.length < bowlingState.teams.B.length ? aSum + bowlingState.handicap : aSum;
      const bAdj = bowlingState.teams.B.length < bowlingState.teams.A.length ? bSum + bowlingState.handicap : bSum;
      
      if (!isNaN(aAdj) && !isNaN(bAdj) && aAdj !== bAdj) {
        if (bowlingState.teams.A.includes(r)) {
          rowClass = aAdj > bAdj ? 'row-win' : 'row-lose';
        } else {
          rowClass = bAdj > aAdj ? 'row-win' : 'row-lose';
        }
      }
    }
    
    tbody += `<tr class="${rowClass}"><td>${name}${teamBadge}</td>`;
    
    for (let c = 0; c < bowlingState.roundCount; c++) {
      const val = bowlingState.scores[r][c] ?? '';
      tbody += `<td><input type="text" inputmode="numeric" pattern="[0-9]*" maxlength="3" value="${val}" data-r="${r}" data-c="${c}" class="bowling-score-input"></td>`;
    }
    
    tbody += `<td><span class="bowling-pill info">${isNaN(sum) ? '-' : sum}</span></td>`;
    tbody += `<td>${isNaN(avg) ? '-' : avg.toFixed(1)}</td>`;
    tbody += '</tr>';
  });
  tbody += '</tbody>';
  
  table.innerHTML = thead + tbody;
  
  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ - ìˆ«ìë§Œ ì…ë ¥ + ìë™ ì´ë™ ë°©ì§€
  table.querySelectorAll('.bowling-score-input').forEach(inp => {
    inp.addEventListener('input', (e) => {
      // ìˆ«ìë§Œ í—ˆìš©
      let val = e.target.value.replace(/[^0-9]/g, '');
      
      // 300 ì´ˆê³¼ ë°©ì§€
      if (val !== '' && parseInt(val) > 300) {
        val = '300';
      }
      
      e.target.value = val;
      
      const r = +e.target.dataset.r;
      const c = +e.target.dataset.c;
      bowlingState.scores[r][c] = val === '' ? null : parseInt(val);
      
      // í•©ê³„/í‰ê· ë§Œ ì—…ë°ì´íŠ¸ (ì „ì²´ ë¦¬ë Œë”ë§ X)
      updateBowlingRowTotals(r);
      if (bowlingState.mode === 'team') {
        updateBowlingTeamColors();
      }
    });
    
    // í‚¤ë³´ë“œë¡œ ìˆ«ì ì…ë ¥ ì‹œ ìë™ ì´ë™ ë°©ì§€
    inp.addEventListener('keydown', (e) => {
      // ìˆ«ì, ë°±ìŠ¤í˜ì´ìŠ¤, íƒ­, í™”ì‚´í‘œë§Œ í—ˆìš©
      const allowed = ['0','1','2','3','4','5','6','7','8','9','Backspace','Tab','ArrowLeft','ArrowRight','ArrowUp','ArrowDown','Delete'];
      if (!allowed.includes(e.key)) {
        e.preventDefault();
      }
    });
  });
}

function updateBowlingRowTotals(r) {
  const sum = bowlingSumRow(r);
  const avg = bowlingAvgRow(r);
  const row = document.querySelector(`#bowlingScoreTable tbody tr:nth-child(${r + 1})`);
  if (row) {
    const cells = row.querySelectorAll('td');
    cells[cells.length - 2].innerHTML = `<span class="bowling-pill info">${isNaN(sum) ? '-' : sum}</span>`;
    cells[cells.length - 1].textContent = isNaN(avg) ? '-' : avg.toFixed(1);
  }
}

function updateBowlingTeamColors() {
  const aSum = bowlingTeamSum(bowlingState.teams.A);
  const bSum = bowlingTeamSum(bowlingState.teams.B);
  const aAdj = bowlingState.teams.A.length < bowlingState.teams.B.length ? aSum + bowlingState.handicap : aSum;
  const bAdj = bowlingState.teams.B.length < bowlingState.teams.A.length ? bSum + bowlingState.handicap : bSum;
  
  document.querySelectorAll('#bowlingScoreTable tbody tr').forEach((row, idx) => {
    row.classList.remove('row-win', 'row-lose');
    if (!isNaN(aAdj) && !isNaN(bAdj) && aAdj !== bAdj) {
      if (bowlingState.teams.A.includes(idx)) {
        row.classList.add(aAdj > bAdj ? 'row-win' : 'row-lose');
      } else {
        row.classList.add(bAdj > aAdj ? 'row-win' : 'row-lose');
      }
    }
  });
}

function toggleBowlingResult() {
  const resultDiv = document.getElementById('bowlingResult');
  if (resultDiv.classList.contains('hidden')) {
    renderBowlingResult();
    resultDiv.classList.remove('hidden');
  } else {
    resultDiv.classList.add('hidden');
  }
}

function toggleBowlingTransfer() {
  const section = document.getElementById('bowlingTransferSection');
  section.classList.toggle('hidden');
}

function formatKRW(n) {
  const sign = n < 0 ? '-' : '';
  const v = Math.abs(n | 0);
  return sign + v.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',') + 'ì›';
}

function renderBowlingResult() {
  const rankList = document.getElementById('bowlingRankList');
  const settleInfo = document.getElementById('bowlingSettleInfo');
  const settleList = document.getElementById('bowlingSettleList');
  const transferList = document.getElementById('bowlingTransferList');
  
  if (bowlingState.mode === 'team') {
    // íŒ€ì „ ê²°ê³¼
    const aSum = bowlingTeamSum(bowlingState.teams.A);
    const bSum = bowlingTeamSum(bowlingState.teams.B);
    const aSize = bowlingState.teams.A.length;
    const bSize = bowlingState.teams.B.length;
    const hc = bowlingState.handicap;
    const aAdj = aSize < bSize ? aSum + hc : aSum;
    const bAdj = bSize < aSize ? bSum + hc : bSum;
    
    let leader = 'ì ìˆ˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”';
    if (!isNaN(aAdj) && !isNaN(bAdj)) {
      leader = aAdj === bAdj ? 'ë™ì !' : (aAdj > bAdj ? 'AíŒ€ ìŠ¹ë¦¬! ğŸ‰' : 'BíŒ€ ìŠ¹ë¦¬! ğŸ‰');
    }
    
    rankList.innerHTML = `
      <div class="bowling-rank-item">
        <div class="bowling-rank-info">
          <span class="bowling-pill info" style="margin-right:8px">AíŒ€</span>
          <span class="bowling-rank-name">${bowlingState.teams.A.map(i => bowlingState.names[i]).join(', ')}</span>
        </div>
        <span class="bowling-pill info">${isNaN(aAdj) ? '-' : aAdj}ì </span>
      </div>
      <div class="bowling-rank-item">
        <div class="bowling-rank-info">
          <span class="bowling-pill bad" style="margin-right:8px">BíŒ€</span>
          <span class="bowling-rank-name">${bowlingState.teams.B.map(i => bowlingState.names[i]).join(', ')}</span>
        </div>
        <span class="bowling-pill info">${isNaN(bAdj) ? '-' : bAdj}ì </span>
      </div>
      <div style="text-align:center;margin-top:8px;font-weight:700;color:var(--accent-green)">${leader}</div>
    `;
    
    // ì •ì‚°
    if (isNaN(aAdj) || isNaN(bAdj)) {
      settleInfo.textContent = 'ì ìˆ˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
      settleList.innerHTML = '';
      transferList.innerHTML = '';
      return;
    }
    
    if (aAdj === bAdj) {
      settleInfo.textContent = 'ë™ì ì…ë‹ˆë‹¤!';
      settleList.innerHTML = '';
      transferList.innerHTML = '';
      return;
    }
    
    const loserTeam = aAdj > bAdj ? 'B' : 'A';
    const loserIdxs = loserTeam === 'A' ? bowlingState.teams.A : bowlingState.teams.B;
    const winnerIdxs = loserTeam === 'A' ? bowlingState.teams.B : bowlingState.teams.A;
    const eachPay = bowlingState.teamFine;
    const pot = loserIdxs.length * eachPay;
    const baseGet = winnerIdxs.length > 0 ? Math.floor(pot / winnerIdxs.length) : 0;
    let remainder = winnerIdxs.length > 0 ? pot % winnerIdxs.length : 0;
    
    settleInfo.textContent = `${loserTeam}íŒ€ íŒ¨ë°° Â· ê° ${formatKRW(eachPay)} ë‚©ë¶€ Â· ìŠ¹ì ê° ì•½ ${formatKRW(baseGet)}`;
    
    let settleHtml = '';
    loserIdxs.forEach(i => {
      settleHtml += `
        <div class="bowling-settle-item">
          <div><div class="bowling-settle-name">${bowlingState.names[i]}</div><div class="bowling-settle-tag">${loserTeam}íŒ€</div></div>
          <span class="bowling-pill bad">-${formatKRW(eachPay)}</span>
        </div>
      `;
    });
    winnerIdxs.forEach(i => {
      const extra = remainder > 0 ? 1 : 0;
      if (remainder > 0) remainder--;
      settleHtml += `
        <div class="bowling-settle-item">
          <div><div class="bowling-settle-name">${bowlingState.names[i]}</div><div class="bowling-settle-tag">${loserTeam === 'A' ? 'B' : 'A'}íŒ€</div></div>
          <span class="bowling-pill good">+${formatKRW(baseGet + extra)}</span>
        </div>
      `;
    });
    settleList.innerHTML = settleHtml;
    
    // ì´ì²´
    const payers = loserIdxs.map(i => ({ name: bowlingState.names[i], amount: eachPay }));
    const receivers = winnerIdxs.map(i => ({ name: bowlingState.names[i], amount: baseGet }));
    const transfers = buildBowlingTransfers([...payers], [...receivers]);
    
    transferList.innerHTML = transfers.map(t => `
      <div class="bowling-transfer-item">
        <div><div class="bowling-transfer-from">${t.from}</div><div class="bowling-transfer-to">â†’ ${t.to}</div></div>
        <span class="bowling-pill bad">-${formatKRW(t.amount)}</span>
      </div>
    `).join('');
    
  } else {
    // ê°œì¸ì „ ê²°ê³¼
    const entries = bowlingState.names.map((name, i) => ({
      i, name, sum: bowlingSumRow(i), avg: bowlingAvgRow(i)
    })).filter(e => !isNaN(e.sum));
    
    entries.sort((a, b) => {
      if (b.sum !== a.sum) return b.sum - a.sum;
      if (isNaN(a.avg) && isNaN(b.avg)) return 0;
      if (isNaN(a.avg)) return 1;
      if (isNaN(b.avg)) return -1;
      return b.avg - a.avg;
    });
    
    rankList.innerHTML = entries.map((e, idx) => {
      const medal = idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : '';
      return `
        <div class="bowling-rank-item">
          <div class="bowling-rank-info">
            <div class="bowling-rank-num">${idx + 1}</div>
            <div>
              <div class="bowling-rank-name">${medal} ${e.name}</div>
              <div class="bowling-rank-score">í•©ê³„ ${e.sum} Â· í‰ê·  ${e.avg.toFixed(1)}</div>
            </div>
          </div>
          ${idx === 0 ? '<span class="bowling-pill good">TOP</span>' : ''}
        </div>
      `;
    }).join('') || '<div style="color:var(--fg-muted)">ì ìˆ˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”</div>';
    
    // ì •ì‚°
    const N = entries.length;
    if (N === 0) {
      settleInfo.textContent = 'ì ìˆ˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
      settleList.innerHTML = '';
      transferList.innerHTML = '';
      return;
    }
    
    const L = Math.min(bowlingState.bottomPayCount, Math.max(1, N - 1));
    const losersIdx = entries.slice(-L).map(e => e.i);
    const winnersIdx = entries.slice(0, -L).map(e => e.i);
    const winnersCount = winnersIdx.length;
    
    const totalPayout = winnersCount * BOWLING_WINNER_BONUS;
    const baseLoserPay = Math.floor(totalPayout / L);
    let remainder = totalPayout % L;
    
    settleInfo.textContent = `ìŠ¹ì ${winnersCount}ëª… ê° +${formatKRW(BOWLING_WINNER_BONUS)} Â· íŒ¨ì ${L}ëª… í•©ê³„ ${formatKRW(totalPayout)} ë¶„ë‹´`;
    
    let settleHtml = '';
    winnersIdx.forEach(i => {
      settleHtml += `
        <div class="bowling-settle-item">
          <div><div class="bowling-settle-name">${bowlingState.names[i]}</div><div class="bowling-settle-tag">ìƒìœ„</div></div>
          <span class="bowling-pill good">+${formatKRW(BOWLING_WINNER_BONUS)}</span>
        </div>
      `;
    });
    losersIdx.forEach(i => {
      const extra = remainder > 0 ? 1 : 0;
      if (remainder > 0) remainder--;
      settleHtml += `
        <div class="bowling-settle-item">
          <div><div class="bowling-settle-name">${bowlingState.names[i]}</div><div class="bowling-settle-tag">í•˜ìœ„</div></div>
          <span class="bowling-pill bad">-${formatKRW(baseLoserPay + extra)}</span>
        </div>
      `;
    });
    settleList.innerHTML = settleHtml;
    
    // ì´ì²´
    const payers = losersIdx.map(i => ({ name: bowlingState.names[i], amount: baseLoserPay }));
    const receivers = winnersIdx.map(i => ({ name: bowlingState.names[i], amount: BOWLING_WINNER_BONUS }));
    const transfers = buildBowlingTransfers([...payers], [...receivers]);
    
    transferList.innerHTML = transfers.map(t => `
      <div class="bowling-transfer-item">
        <div><div class="bowling-transfer-from">${t.from}</div><div class="bowling-transfer-to">â†’ ${t.to}</div></div>
        <span class="bowling-pill bad">-${formatKRW(t.amount)}</span>
      </div>
    `).join('');
  }
}

function buildBowlingTransfers(payers, receivers) {
  const transfers = [];
  let i = 0, j = 0;
  while (i < payers.length && j < receivers.length) {
    let due = payers[i].amount;
    let need = receivers[j].amount;
    if (due <= 0) { i++; continue; }
    if (need <= 0) { j++; continue; }
    const x = Math.min(due, need);
    transfers.push({ from: payers[i].name, to: receivers[j].name, amount: x });
    payers[i].amount -= x;
    receivers[j].amount -= x;
    if (payers[i].amount === 0) i++;
    if (receivers[j].amount === 0) j++;
  }
  return transfers;
}

// ë³¼ë§ ì´ˆê¸°í™”
initBowlingNames();
renderBowlingNameFields();
</script>

</body>
</html>
